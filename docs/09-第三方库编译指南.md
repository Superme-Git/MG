# ç¬¬ä¸‰æ–¹ä¾èµ–åº“é‡æ–°ç¼–è¯‘å®Œå…¨æŒ‡å—

## ğŸ“‹ ç›®å½•

- [1. é—®é¢˜èƒŒæ™¯](#1-é—®é¢˜èƒŒæ™¯)
- [2. ä¾èµ–åº“æ¦‚è§ˆ](#2-ä¾èµ–åº“æ¦‚è§ˆ)
- [3. ç¼–è¯‘å‰å‡†å¤‡](#3-ç¼–è¯‘å‰å‡†å¤‡)
- [4. ä¾èµ–åº“è¯¦ç»†ç¼–è¯‘æŒ‡å—](#4-ä¾èµ–åº“è¯¦ç»†ç¼–è¯‘æŒ‡å—)
- [5. è‡ªåŠ¨åŒ–ç¼–è¯‘è„šæœ¬](#5-è‡ªåŠ¨åŒ–ç¼–è¯‘è„šæœ¬)
- [6. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#6-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
- [7. éªŒè¯ä¸æµ‹è¯•](#7-éªŒè¯ä¸æµ‹è¯•)

---

## 1. é—®é¢˜èƒŒæ™¯

### 1.1 è¿è¡Œæ—¶åº“ä¸åŒ¹é…é—®é¢˜

å½“å‰ç¼–è¯‘é”™è¯¯çš„æ ¹æœ¬åŸå› æ˜¯ **Visual C++ è¿è¡Œæ—¶åº“æ··ç”¨é—®é¢˜**ï¼š

- **ä¸»é¡¹ç›®é…ç½®**ï¼šä½¿ç”¨åŠ¨æ€é“¾æ¥è¿è¡Œæ—¶åº“ `MultiThreadedDLL (/MD)`
- **ä¾èµ–åº“é…ç½®**ï¼šéƒ¨åˆ†ä½¿ç”¨é™æ€é“¾æ¥è¿è¡Œæ—¶åº“ `MultiThreaded (/MT)` æˆ–å…¶ä»–ç‰ˆæœ¬
- **é“¾æ¥å™¨é…ç½®é”™è¯¯**ï¼šåœ¨å¿½ç•¥åº“åˆ—è¡¨ä¸­åŒ…å«äº† `msvcrt.lib`ï¼Œä½†è¿è¡Œæ—¶åº“åˆè®¾ç½®ä¸º `/MD`

### 1.2 é”™è¯¯è¡¨ç°

```
error LNK2001: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· @__security_check_cookie@4
error LNK2001: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· ___security_cookie
error LNK2001: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· _memcpy
error LNK2001: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· operator new/delete
...å…±è®¡ 7,029 ä¸ªé“¾æ¥é”™è¯¯
```

### 1.3 è§£å†³æ–¹æ¡ˆ

é‡æ–°ç¼–è¯‘æ‰€æœ‰ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼Œç»Ÿä¸€ä½¿ç”¨ï¼š
- **å¹³å°å·¥å…·é›†**: `v140` (Visual Studio 2015)
- **è¿è¡Œæ—¶åº“**: `MultiThreadedDLL (/MD)` for Release
- **è¿è¡Œæ—¶åº“**: `MultiThreadedDebugDLL (/MDd)` for Debug
- **Windows SDK**: `10.0.19041.0` æˆ–å…¼å®¹ç‰ˆæœ¬

---

## 2. ä¾èµ–åº“æ¦‚è§ˆ

### 2.1 ä¾èµ–å…³ç³»å›¾

```
ç¬¬ä¸€å±‚ï¼ˆåŸºç¡€åº“ï¼‰ï¼š
â”œâ”€â”€ zlib (å‹ç¼©)
â”œâ”€â”€ pcre (æ­£åˆ™è¡¨è¾¾å¼)
â”œâ”€â”€ freetype (å­—ä½“æ¸²æŸ“)
â”œâ”€â”€ libjpeg (JPEGå›¾åƒ)
â”œâ”€â”€ libpng (PNGå›¾åƒï¼Œä¾èµ–zlib)
â”œâ”€â”€ libtiff (TIFFå›¾åƒ)
â”œâ”€â”€ libogg (éŸ³é¢‘å®¹å™¨)
â”œâ”€â”€ libvorbis (éŸ³é¢‘ç¼–è§£ç ï¼Œä¾èµ–libogg)
â”œâ”€â”€ libspeex (è¯­éŸ³ç¼–è§£ç )
â””â”€â”€ silly (å›¾åƒåŠ è½½)

ç¬¬äºŒå±‚ï¼ˆå¹³å°åº“ï¼‰ï¼š
â”œâ”€â”€ lua (è„šæœ¬å¼•æ“)
â”œâ”€â”€ tolua++ (Luaç»‘å®šï¼Œä¾èµ–lua)
â”œâ”€â”€ platform (å¹³å°æŠ½è±¡å±‚)
â”œâ”€â”€ cauthc (è®¤è¯åº“)
â””â”€â”€ ljfm (æ–‡ä»¶ç®¡ç†)

ç¬¬ä¸‰å±‚ï¼ˆå¼•æ“åº“ï¼‰ï¼š
â”œâ”€â”€ cegui (UIåº“ï¼Œä¾èµ–freetype/pcre/silly/lua)
â”œâ”€â”€ cocos2d-x (æ¸¸æˆå¼•æ“ï¼Œä¾èµ–zlib/png/jpegç­‰)
â””â”€â”€ engine (æ¸¸æˆå¼•æ“æ‰©å±•ï¼Œä¾èµ–cocos2d-x/platform/ljfm)

ç¬¬å››å±‚ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼š
â””â”€â”€ FireClient (æ¸¸æˆå®¢æˆ·ç«¯ï¼Œä¾èµ–æ‰€æœ‰ä¸Šå±‚åº“)
```

### 2.2 ä¾èµ–åº“æ¸…å•

| åº“å | ç”¨é€” | è¾“å‡ºæ–‡ä»¶ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|
| zlib | æ•°æ®å‹ç¼© | zlib.lib | â­â­â­â­â­ |
| pcre | æ­£åˆ™è¡¨è¾¾å¼ | pcre.lib | â­â­â­â­ |
| freetype | å­—ä½“æ¸²æŸ“ | freetype.lib | â­â­â­â­â­ |
| libjpeg | JPEGå›¾åƒ | libjpeg.lib | â­â­â­â­â­ |
| libpng | PNGå›¾åƒ | libpng.lib | â­â­â­â­â­ |
| libtiff | TIFFå›¾åƒ | libtiff.lib | â­â­â­ |
| libogg | éŸ³é¢‘å®¹å™¨ | libogg.lib | â­â­â­â­ |
| libvorbis | éŸ³é¢‘ç¼–è§£ç  | libvorbis.lib, libvorbisfile.lib | â­â­â­â­ |
| libspeex | è¯­éŸ³ç¼–è§£ç  | libspeex.lib | â­â­â­ |
| silly | å›¾åƒåŠ è½½ | silly.lib | â­â­â­ |
| lua | è„šæœ¬å¼•æ“ | lua.lib, liblua.lib | â­â­â­â­â­ |
| tolua++ | Luaç»‘å®š | tolua++.lib | â­â­â­â­ |
| platform | å¹³å°å±‚ | platform.lib | â­â­â­â­â­ |
| cauthc | è®¤è¯ | cauthc.lib | â­â­â­â­â­ |
| ljfm | æ–‡ä»¶ç®¡ç† | ljfm.lib | â­â­â­â­â­ |
| cegui | UIæ¡†æ¶ | cegui.lib | â­â­â­â­â­ |
| cocos2d-x | æ¸¸æˆå¼•æ“ | libcocos2d.lib, libCocosDenshion.lib, libSpine.lib, libBox2D.lib | â­â­â­â­â­ |
| engine | å¼•æ“æ‰©å±• | engine.lib | â­â­â­â­â­ |

---

## 3. ç¼–è¯‘å‰å‡†å¤‡

### 3.1 ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 7/10/11
- **Visual Studio**: Visual Studio 2015 (v140) æˆ–æ›´é«˜ç‰ˆæœ¬
- **Windows SDK**: 10.0.19041.0 æˆ–å…¼å®¹ç‰ˆæœ¬
- **MSBuild**: éš Visual Studio å®‰è£…
- **PowerShell**: 5.0 æˆ–æ›´é«˜ç‰ˆæœ¬

### 3.2 æ£€æŸ¥ç°æœ‰ç¯å¢ƒ

```batch
REM æ£€æŸ¥ Visual Studio å®‰è£…
where msbuild

REM æ£€æŸ¥ Windows SDK
dir "C:\Program Files (x86)\Windows Kits\10\Include"

REM æ£€æŸ¥å¹³å°å·¥å…·é›†
dir "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC"
```

### 3.3 å¤‡ä»½ç°æœ‰åº“æ–‡ä»¶

```batch
REM åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir backup_libs_%date:~0,4%%date:~5,2%%date:~8,2%

REM å¤‡ä»½é¢„ç¼–è¯‘åº“
xcopy /E /I /Y dependencies\*\prebuilt backup_libs_%date:~0,4%%date:~5,2%%date:~8,2%\dependencies_prebuilt
xcopy /E /I /Y cocos2d-2.0-rc2-x-2.0.1\Release.win32 backup_libs_%date:~0,4%%date:~5,2%%date:~8,2%\cocos2d_release
xcopy /E /I /Y common\*\Release.win32 backup_libs_%date:~0,4%%date:~5,2%%date:~8,2%\common_release
xcopy /E /I /Y engine\Release.win32 backup_libs_%date:~0,4%%date:~5,2%%date:~8,2%\engine_release
```

### 3.4 æ¸…ç†æ—§çš„ç¼–è¯‘è¾“å‡º

```batch
REM æ¸…ç†æ‰€æœ‰ Release.win32 ç›®å½•
for /d /r . %d in (Release.win32) do @if exist "%d" rd /s /q "%d"

REM æ¸…ç†æ‰€æœ‰ Debug.win32 ç›®å½•
for /d /r . %d in (Debug.win32) do @if exist "%d" rd /s /q "%d"
```

---

## 4. ä¾èµ–åº“è¯¦ç»†ç¼–è¯‘æŒ‡å—

### 4.1 ç¬¬ä¸€å±‚ï¼šåŸºç¡€åº“

#### 4.1.1 zlib - å‹ç¼©åº“

**ä½ç½®**: `cocos2d-2.0-rc2-x-2.0.1\cocos2dx\platform\third_party\win32\zlib`

**è¯´æ˜**: zlib é€šå¸¸ä½œä¸º cocos2d é¡¹ç›®çš„ä¸€éƒ¨åˆ†ç¼–è¯‘ï¼Œæ— éœ€å•ç‹¬ç¼–è¯‘ã€‚

**å¦‚éœ€å•ç‹¬ç¼–è¯‘**:
```batch
cd cocos2d-2.0-rc2-x-2.0.1\cocos2dx\platform\third_party\win32\libraries
REM æ£€æŸ¥æ˜¯å¦æœ‰ zlib.lib
dir zlib.lib
```

---

#### 4.1.2 PCRE - æ­£åˆ™è¡¨è¾¾å¼åº“

**ä½ç½®**: `dependencies\pcre-8.31`

**é¡¹ç›®æ–‡ä»¶**:
- æ ‡å‡†ç‰ˆ: `dependencies\pcre-8.31\pcre-8.31.vcxproj`
- Win32ç‰ˆ: `dependencies\pcre-8.31\pcre-8.31.win32.vcxproj`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€é¡¹ç›®**:
```batch
cd dependencies\pcre-8.31
start pcre-8.31.win32.vcxproj
```

2. **ä¿®æ”¹é¡¹ç›®å±æ€§** (åœ¨ Visual Studio ä¸­):
   - å³é”®é¡¹ç›® â†’ å±æ€§
   - é…ç½®: `Release`ï¼Œå¹³å°: `Win32`
   - **å¸¸è§„**:
     - å¹³å°å·¥å…·é›†: `v140`
     - Windows SDK ç‰ˆæœ¬: `10.0.19041.0` æˆ–æœ€æ–°
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ**:
     - è¿è¡Œåº“: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **é¢„å¤„ç†å™¨**:
     - ç¡®ä¿å®šä¹‰: `WIN32;NDEBUG;_LIB;PCRE_STATIC;HAVE_CONFIG_H`

3. **ç¼–è¯‘**:
```batch
msbuild pcre-8.31.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

4. **éªŒè¯è¾“å‡º**:
```batch
dir Release.win32\pcre.lib
```

---

#### 4.1.3 FreeType - å­—ä½“æ¸²æŸ“åº“

**ä½ç½®**: `dependencies\freetype-2.4.9`

**é¡¹ç›®æ–‡ä»¶**: `dependencies\freetype-2.4.9\builds\win32\vc2010\freetype.vcxproj`

**è§£å†³æ–¹æ¡ˆ**: `dependencies\freetype-2.4.9\builds\win32\vc2010\freetype.sln`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€è§£å†³æ–¹æ¡ˆ**:
```batch
cd dependencies\freetype-2.4.9\builds\win32\vc2010
start freetype.sln
```

2. **å‡çº§é¡¹ç›®** (é¦–æ¬¡æ‰“å¼€æ—¶):
   - é€‰æ‹© "é‡å®šå‘é¡¹ç›®"
   - å¹³å°å·¥å…·é›†: `v140`
   - Windows SDK: `10.0.19041.0`

3. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - é…ç½®: `Release` æˆ– `Release Multithreaded`
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **é¢„å¤„ç†å™¨**:
     - ç¡®ä¿å®šä¹‰: `WIN32;NDEBUG;_LIB;_CRT_SECURE_NO_WARNINGS`

4. **ç¼–è¯‘**:
```batch
msbuild freetype.sln /t:Rebuild /p:Configuration="Release Multithreaded" /p:Platform=Win32 /p:PlatformToolset=v140
```

5. **å¤åˆ¶è¾“å‡ºåˆ°é¢„ç¼–è¯‘ç›®å½•**:
```batch
copy objs\win32\vc2010\freetype249MT.lib ..\..\..\..\..\dependencies\FreeType\Win32\Lib\freetype.lib
```

---

#### 4.1.4 libpng - PNG å›¾åƒåº“

**ä½ç½®**: `dependencies\png`

**ä¾èµ–**: zlib

**æ£€æŸ¥é¢„ç¼–è¯‘åº“**:
```batch
cd dependencies\png\prebuilt\win32
dir libpng.lib
```

**å¦‚éœ€é‡æ–°ç¼–è¯‘**:
- æŸ¥æ‰¾æºç : `dependencies\png` æˆ–åœ¨ `tools\engine\contrib\lpng1234` ä¸­æŸ¥æ‰¾
- ä½¿ç”¨ Visual Studio é¡¹ç›®æ–‡ä»¶é‡æ–°ç¼–è¯‘

**æ¨è**: å¦‚æœæœ‰é¢„ç¼–è¯‘ç‰ˆæœ¬ä¸”å…¼å®¹ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚

---

#### 4.1.5 libjpeg - JPEG å›¾åƒåº“

**ä½ç½®**: `dependencies\jpeg`

**æ£€æŸ¥é¢„ç¼–è¯‘åº“**:
```batch
cd dependencies\jpeg\prebuilt\win32
dir libjpeg.lib
```

**å¦‚éœ€é‡æ–°ç¼–è¯‘**:
- æŸ¥æ‰¾æºç : `dependencies\jpeg` æˆ–åœ¨ `tools\engine\contrib\jpeg-6b` ä¸­æŸ¥æ‰¾
- ä½¿ç”¨å¯¹åº”çš„é¡¹ç›®æ–‡ä»¶ç¼–è¯‘

---

#### 4.1.6 libtiff - TIFF å›¾åƒåº“

**ä½ç½®**: `dependencies\wxWidgets-2.8.11\src\tiff`

**é¡¹ç›®æ–‡ä»¶**: `dependencies\wxWidgets-2.8.11\src\tiff\tiff.vcxproj`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€é¡¹ç›®**:
```batch
cd dependencies\wxWidgets-2.8.11\src\tiff
start tiff.vcxproj
```

2. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - å¹³å°å·¥å…·é›†: `v140`
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`

3. **ç¼–è¯‘**:
```batch
msbuild tiff.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

---

#### 4.1.7 libogg - éŸ³é¢‘å®¹å™¨åº“

**ä½ç½®**: `dependencies\libogg-1.3.2`

**é¡¹ç›®æ–‡ä»¶**: `dependencies\libogg-1.3.2\win32\VS2010\libogg_static.vcxproj`

**è§£å†³æ–¹æ¡ˆ**: `dependencies\libogg-1.3.2\win32\VS2010\libogg_static.sln`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€è§£å†³æ–¹æ¡ˆ**:
```batch
cd dependencies\libogg-1.3.2\win32\VS2010
start libogg_static.sln
```

2. **å‡çº§é¡¹ç›®**:
   - å¹³å°å·¥å…·é›†: `v140`
   - Windows SDK: `10.0.19041.0`

3. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`

4. **ç¼–è¯‘**:
```batch
msbuild libogg_static.sln /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

5. **éªŒè¯è¾“å‡º**:
```batch
dir Win32\Release\libogg_static.lib
```

---

#### 4.1.8 libvorbis - éŸ³é¢‘ç¼–è§£ç åº“

**ä½ç½®**: `dependencies\libvorbis-1.3.5`

**é¡¹ç›®æ–‡ä»¶**: `dependencies\libvorbis-1.3.5\win32\VS2010\libvorbis\libvorbis_static.vcxproj`

**è§£å†³æ–¹æ¡ˆ**: `dependencies\libvorbis-1.3.5\win32\VS2010\vorbis_static.sln`

**ä¾èµ–**: libogg (éœ€å…ˆç¼–è¯‘)

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€è§£å†³æ–¹æ¡ˆ**:
```batch
cd dependencies\libvorbis-1.3.5\win32\VS2010
start vorbis_static.sln
```

2. **å‡çº§æ‰€æœ‰é¡¹ç›®**:
   - å¹³å°å·¥å…·é›†: `v140`

3. **ä¿®æ”¹é¡¹ç›®å±æ€§** (å¯¹æ‰€æœ‰é¡¹ç›®):
   - libvorbis_static
   - libvorbisfile_static
   - vorbisenc_static

   æ¯ä¸ªé¡¹ç›®è®¾ç½®:
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **å¸¸è§„** â†’ **é™„åŠ åŒ…å«ç›®å½•**: æ·»åŠ  libogg çš„åŒ…å«ç›®å½•

4. **ç¼–è¯‘**:
```batch
msbuild vorbis_static.sln /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

5. **éªŒè¯è¾“å‡º**:
```batch
dir Win32\Release\libvorbis_static.lib
dir Win32\Release\libvorbisfile_static.lib
```

---

#### 4.1.9 libspeex - è¯­éŸ³ç¼–è§£ç åº“

**ä½ç½®**: `dependencies\speex-1.2rc2`

**é¡¹ç›®æ–‡ä»¶**: `dependencies\speex-1.2rc2\win32\VS2008\libspeex\libspeex.vcxproj`

**è§£å†³æ–¹æ¡ˆ**: `dependencies\speex-1.2rc2\win32\VS2008\libspeex.sln`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€è§£å†³æ–¹æ¡ˆ**:
```batch
cd dependencies\speex-1.2rc2\win32\VS2008
start libspeex.sln
```

2. **å‡çº§é¡¹ç›®**:
   - å¹³å°å·¥å…·é›†: `v140`

3. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **é¢„å¤„ç†å™¨**: ç¡®ä¿å®šä¹‰ `HAVE_CONFIG_H`

4. **ç¼–è¯‘**:
```batch
msbuild libspeex.sln /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

---

#### 4.1.10 SILLY - å›¾åƒåŠ è½½åº“

**ä½ç½®**: `dependencies\SILLY-0.1.0`

**é¡¹ç›®æ–‡ä»¶**:
- `dependencies\SILLY-0.1.0\SILLY-0.1.0.vcxproj`
- `dependencies\SILLY-0.1.0\SILLY-0.1.0.win32.vcxproj`

**è§£å†³æ–¹æ¡ˆ**: `dependencies\SILLY-0.1.0\silly\SILLY.sln`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€è§£å†³æ–¹æ¡ˆ**:
```batch
cd dependencies\SILLY-0.1.0\silly
start SILLY.sln
```

2. **å‡çº§é¡¹ç›®**:
   - å¹³å°å·¥å…·é›†: `v140`

3. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`

4. **ç¼–è¯‘**:
```batch
msbuild SILLY.sln /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

---

### 4.2 ç¬¬äºŒå±‚ï¼šå¹³å°åŸºç¡€åº“

#### 4.2.1 Lua - è„šæœ¬å¼•æ“

**ä½ç½®**: `common\lua`

**é¡¹ç›®æ–‡ä»¶**:
- `common\lua\lua.vcxproj`
- `common\lua\lua.win32.vcxproj`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€é¡¹ç›®**:
```batch
cd common\lua
start lua.win32.vcxproj
```

2. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - å¹³å°å·¥å…·é›†: `v140`
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **é¢„å¤„ç†å™¨**: ç¡®ä¿å®šä¹‰ `WIN32;NDEBUG;_LIB;LUA_BUILD_AS_DLL=0`

3. **ç¼–è¯‘**:
```batch
msbuild lua.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

4. **éªŒè¯è¾“å‡º**:
```batch
dir Release.win32\lua.lib
dir Release.win32\liblua.lib
```

---

#### 4.2.2 tolua++ - Lua ç»‘å®šå·¥å…·

**ä½ç½®**: `common\tolua++-1.0.93`

**é¡¹ç›®æ–‡ä»¶**: `common\tolua++-1.0.93\win32\vc7\toluapp.vcxproj`

**ä¾èµ–**: lua.lib

**ç¼–è¯‘æ­¥éª¤**:

1. **ç¡®ä¿ Lua å·²ç¼–è¯‘**

2. **æ‰“å¼€é¡¹ç›®**:
```batch
cd common\tolua++-1.0.93\win32\vc7
start toluapp.vcxproj
```

3. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - å¹³å°å·¥å…·é›†: `v140`
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **é™„åŠ åŒ…å«ç›®å½•**: æ·»åŠ  Lua å¤´æ–‡ä»¶è·¯å¾„
   - **é“¾æ¥å™¨** â†’ **é™„åŠ åº“ç›®å½•**: æ·»åŠ  Lua åº“è·¯å¾„

4. **ç¼–è¯‘**:
```batch
msbuild toluapp.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

---

#### 4.2.3 platform - å¹³å°æŠ½è±¡å±‚

**ä½ç½®**: `common\platform`

**é¡¹ç›®æ–‡ä»¶**:
- `common\platform\platform.vcxproj`
- `common\platform\platform.win32.vcxproj`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€é¡¹ç›®**:
```batch
cd common\platform
start platform.win32.vcxproj
```

2. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - å¹³å°å·¥å…·é›†: `v140`
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **é¢„å¤„ç†å™¨**: ç¡®ä¿å®šä¹‰ `WIN32;WIN7_32;NDEBUG;_LIB`

3. **ç¼–è¯‘**:
```batch
msbuild platform.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

4. **éªŒè¯è¾“å‡º**:
```batch
dir Release.win32\platform.lib
```

---

#### 4.2.4 cauthc - è®¤è¯åº“

**ä½ç½®**: `common\cauthc`

**é¡¹ç›®æ–‡ä»¶**: `common\cauthc\projects\windows\cauthc.win32.vcxproj`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€é¡¹ç›®**:
```batch
cd common\cauthc\projects\windows
start cauthc.win32.vcxproj
```

2. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - å¹³å°å·¥å…·é›†: `v140`
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`

3. **ç¼–è¯‘**:
```batch
msbuild cauthc.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

4. **éªŒè¯è¾“å‡º**:
```batch
dir Release.win32\cauthc.lib
```

---

#### 4.2.5 ljfm - æ–‡ä»¶ç®¡ç†åº“

**ä½ç½®**: `common\ljfm`

**é¡¹ç›®æ–‡ä»¶**:
- `common\ljfm\ljfm.vcxproj`
- `common\ljfm\ljfm.win32.vcxproj`

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€é¡¹ç›®**:
```batch
cd common\ljfm
start ljfm.win32.vcxproj
```

2. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - å¹³å°å·¥å…·é›†: `v140`
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`

3. **ç¼–è¯‘**:
```batch
msbuild ljfm.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

4. **éªŒè¯è¾“å‡º**:
```batch
dir Release.win32\ljfm.lib
```

---

### 4.3 ç¬¬ä¸‰å±‚ï¼šå¼•æ“åº“

#### 4.3.1 CEGUI - UI åº“

**ä½ç½®**: `dependencies\cegui`

**é¡¹ç›®æ–‡ä»¶**: `dependencies\cegui\project\win32\cegui.win32.vcxproj`

**ä¾èµ–**: FreeType, PCRE, SILLY, Lua

**ç¼–è¯‘æ­¥éª¤**:

1. **ç¡®ä¿æ‰€æœ‰ä¾èµ–åº“å·²ç¼–è¯‘**

2. **æ‰“å¼€é¡¹ç›®**:
```batch
cd dependencies\cegui\project\win32
start cegui.win32.vcxproj
```

3. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - å¹³å°å·¥å…·é›†: `v140`
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **é™„åŠ åŒ…å«ç›®å½•**: ç¡®ä¿åŒ…å«æ‰€æœ‰ä¾èµ–åº“çš„å¤´æ–‡ä»¶è·¯å¾„
   - **C/C++** â†’ **é¢„å¤„ç†å™¨**: ç¡®ä¿å®šä¹‰ `CEGUI_STATIC;WIN32;NDEBUG;_LIB`

4. **ç¼–è¯‘**:
```batch
msbuild cegui.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

5. **éªŒè¯è¾“å‡º**:
```batch
dir Release.win32\cegui.lib
```

---

#### 4.3.2 Cocos2d-x - æ¸¸æˆå¼•æ“æ ¸å¿ƒ

**ä½ç½®**: `cocos2d-2.0-rc2-x-2.0.1`

**è§£å†³æ–¹æ¡ˆ**: `cocos2d-2.0-rc2-x-2.0.1\cocos2d-win32.vc2010.sln`

**ä¾èµ–**: zlib, libpng, libjpeg, libcurl, pthread

**ç¼–è¯‘æ­¥éª¤**:

1. **æ‰“å¼€è§£å†³æ–¹æ¡ˆ**:
```batch
cd cocos2d-2.0-rc2-x-2.0.1
start cocos2d-win32.vc2010.sln
```

2. **å‡çº§æ‰€æœ‰é¡¹ç›®**:
   - é¡¹ç›® â†’ é‡å®šå‘è§£å†³æ–¹æ¡ˆ
   - å¹³å°å·¥å…·é›†: `v140`
   - Windows SDK: `10.0.19041.0`

3. **æ‰¹é‡ä¿®æ”¹é¡¹ç›®å±æ€§**:
   å¯¹ä»¥ä¸‹é¡¹ç›®é€ä¸€è®¾ç½®:
   - libcocos2d
   - libCocosDenshion
   - libSpine
   - libBox2D
   - esUtil

   æ¯ä¸ªé¡¹ç›®:
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **é¢„å¤„ç†å™¨**: ç¡®ä¿å®šä¹‰æ­£ç¡®çš„å®

4. **ç¼–è¯‘æ•´ä¸ªè§£å†³æ–¹æ¡ˆ**:
```batch
msbuild cocos2d-win32.vc2010.sln /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

5. **éªŒè¯è¾“å‡º**:
```batch
dir Release.win32\libcocos2d.lib
dir Release.win32\libCocosDenshion.lib
dir Release.win32\libSpine.lib
dir Release.win32\libBox2D.lib
```

---

#### 4.3.3 engine - æ¸¸æˆå¼•æ“æ‰©å±•

**ä½ç½®**: `engine`

**é¡¹ç›®æ–‡ä»¶**: `engine\engine.vcxproj` æˆ– `engine\engine.win32.vcxproj`

**ä¾èµ–**: Cocos2d-x, platform, ljfm

**ç¼–è¯‘æ­¥éª¤**:

1. **ç¡®ä¿æ‰€æœ‰ä¾èµ–åº“å·²ç¼–è¯‘**

2. **æ‰“å¼€é¡¹ç›®**:
```batch
cd engine
start engine.win32.vcxproj
```

3. **ä¿®æ”¹é¡¹ç›®å±æ€§**:
   - å¹³å°å·¥å…·é›†: `v140`
   - **C/C++** â†’ **ä»£ç ç”Ÿæˆ** â†’ **è¿è¡Œåº“**: `å¤šçº¿ç¨‹ DLL (/MD)`
   - **C/C++** â†’ **é™„åŠ åŒ…å«ç›®å½•**: ç¡®ä¿åŒ…å«æ‰€æœ‰ä¾èµ–åº“çš„å¤´æ–‡ä»¶è·¯å¾„

4. **ç¼–è¯‘**:
```batch
msbuild engine.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

5. **éªŒè¯è¾“å‡º**:
```batch
dir Release.win32\engine.lib
```

---

### 4.4 ç¬¬å››å±‚ï¼šå®¢æˆ·ç«¯åº“

#### 4.4.1 FireClient - æ¸¸æˆå®¢æˆ·ç«¯åº“

**ä½ç½®**: `client\FireClient`

**é¡¹ç›®æ–‡ä»¶**: å¯èƒ½æ˜¯ `client\FireClient\FireClient.vcxproj` æˆ–ç±»ä¼¼

**ä¾èµ–**: æ‰€æœ‰ä¸Šå±‚åº“

**ç¼–è¯‘æ­¥éª¤**:

1. **ç¡®ä¿æ‰€æœ‰ä¾èµ–åº“å·²ç¼–è¯‘**

2. **æŸ¥æ‰¾é¡¹ç›®æ–‡ä»¶**:
```batch
cd client\FireClient
dir *.vcxproj
```

3. **æ‰“å¼€å¹¶ç¼–è¯‘**:
```batch
msbuild FireClient.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140
```

---

## 5. è‡ªåŠ¨åŒ–ç¼–è¯‘è„šæœ¬

### 5.1 PowerShell æ‰¹é‡é…ç½®è„šæœ¬

åˆ›å»ºæ–‡ä»¶: `fix_all_vcxproj_runtime.ps1`

```powershell
# fix_all_vcxproj_runtime.ps1
# æ‰¹é‡ä¿®æ”¹æ‰€æœ‰ .vcxproj æ–‡ä»¶çš„è¿è¡Œæ—¶åº“è®¾ç½®

param(
    [string]$RootPath = "E:\æ¢¦å¹»è¥¿æ¸¸MGåŸç‰ˆæºç ",
    [switch]$DryRun = $false
)

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "Visual C++ è¿è¡Œæ—¶åº“æ‰¹é‡ä¿®å¤å·¥å…·" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""

$vcxprojFiles = Get-ChildItem -Path $RootPath -Filter "*.vcxproj" -Recurse -File

Write-Host "æ‰¾åˆ° $($vcxprojFiles.Count) ä¸ªé¡¹ç›®æ–‡ä»¶" -ForegroundColor Green
Write-Host ""

$modifiedCount = 0

foreach ($file in $vcxprojFiles) {
    Write-Host "å¤„ç†: $($file.Name)" -ForegroundColor Yellow
    Write-Host "è·¯å¾„: $($file.DirectoryName)" -ForegroundColor Gray

    try {
        $content = Get-Content $file.FullName -Raw -Encoding UTF8
        $originalContent = $content

        # 1. ä¿®æ”¹ Release é…ç½®çš„è¿è¡Œæ—¶åº“ä¸º MultiThreadedDLL (/MD)
        $content = $content -replace '<RuntimeLibrary>MultiThreaded</RuntimeLibrary>', '<RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>'

        # 2. ä¿®æ”¹ Debug é…ç½®çš„è¿è¡Œæ—¶åº“ä¸º MultiThreadedDebugDLL (/MDd)
        $content = $content -replace '<RuntimeLibrary>MultiThreadedDebug</RuntimeLibrary>', '<RuntimeLibrary>MultiThreadedDebugDLL</RuntimeLibrary>'

        # 3. ç¡®ä¿å¹³å°å·¥å…·é›†ä¸º v140
        $content = $content -replace '<PlatformToolset>v\d+</PlatformToolset>', '<PlatformToolset>v140</PlatformToolset>'

        # 4. ç§»é™¤å¯¹ msvcrt.lib çš„å¿½ç•¥ï¼ˆä½¿ç”¨æ›´å¤æ‚çš„æ­£åˆ™ï¼‰
        $content = $content -replace '(<IgnoreSpecificDefaultLibraries>)([^<]*);?msvcrt\.lib;?([^<]*)(</IgnoreSpecificDefaultLibraries>)', '$1$2$3$4'
        $content = $content -replace '(<IgnoreSpecificDefaultLibraries>)msvcrt\.lib;?([^<]*)(</IgnoreSpecificDefaultLibraries>)', '$1$2$3'
        $content = $content -replace '(<IgnoreSpecificDefaultLibraries>)([^<]*);?msvcrt\.lib(</IgnoreSpecificDefaultLibraries>)', '$1$2$3'

        # 5. æ¸…ç†ç©ºçš„ IgnoreSpecificDefaultLibraries æ ‡ç­¾
        $content = $content -replace '<IgnoreSpecificDefaultLibraries>\s*</IgnoreSpecificDefaultLibraries>', ''
        $content = $content -replace '<IgnoreSpecificDefaultLibraries>;+</IgnoreSpecificDefaultLibraries>', ''

        if ($content -ne $originalContent) {
            if (-not $DryRun) {
                Set-Content -Path $file.FullName -Value $content -Encoding UTF8 -NoNewline
                Write-Host "  âœ“ å·²ä¿®æ”¹" -ForegroundColor Green
                $modifiedCount++
            } else {
                Write-Host "  âœ“ éœ€è¦ä¿®æ”¹ (DryRun æ¨¡å¼)" -ForegroundColor Cyan
                $modifiedCount++
            }
        } else {
            Write-Host "  - æ— éœ€ä¿®æ”¹" -ForegroundColor Gray
        }
    }
    catch {
        Write-Host "  âœ— é”™è¯¯: $($_.Exception.Message)" -ForegroundColor Red
    }

    Write-Host ""
}

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "å¤„ç†å®Œæˆï¼" -ForegroundColor Green
Write-Host "æ€»è®¡: $($vcxprojFiles.Count) ä¸ªæ–‡ä»¶" -ForegroundColor White
Write-Host "ä¿®æ”¹: $modifiedCount ä¸ªæ–‡ä»¶" -ForegroundColor Green
if ($DryRun) {
    Write-Host "æ¨¡å¼: DryRun (æœªå®é™…ä¿®æ”¹)" -ForegroundColor Yellow
}
Write-Host "========================================" -ForegroundColor Cyan
```

**ä½¿ç”¨æ–¹æ³•**:

```powershell
# é¢„è§ˆæ¨¡å¼ï¼ˆä¸å®é™…ä¿®æ”¹ï¼‰
.\fix_all_vcxproj_runtime.ps1 -DryRun

# å®é™…ä¿®æ”¹
.\fix_all_vcxproj_runtime.ps1
```

---

### 5.2 æ‰¹å¤„ç†è‡ªåŠ¨åŒ–ç¼–è¯‘è„šæœ¬

åˆ›å»ºæ–‡ä»¶: `build_all_dependencies.bat`

```batch
@echo off
REM build_all_dependencies.bat
REM è‡ªåŠ¨åŒ–ç¼–è¯‘æ‰€æœ‰ä¾èµ–åº“

setlocal enabledelayedexpansion

echo ========================================
echo ç¬¬ä¸‰æ–¹ä¾èµ–åº“è‡ªåŠ¨ç¼–è¯‘è„šæœ¬
echo ========================================
echo.

set ROOT_DIR=%~dp0
set BUILD_CONFIG=Release
set BUILD_PLATFORM=Win32
set TOOLSET=v140
set LOG_DIR=%ROOT_DIR%build_logs
set ERROR_COUNT=0

REM åˆ›å»ºæ—¥å¿—ç›®å½•
if not exist "%LOG_DIR%" mkdir "%LOG_DIR%"

echo [%time%] å¼€å§‹ç¼–è¯‘...
echo.

REM ========================================
REM ç¬¬ä¸€å±‚ï¼šåŸºç¡€åº“
REM ========================================

echo ======== ç¬¬ä¸€å±‚ï¼šåŸºç¡€åº“ ========
echo.

REM PCRE
echo [1/18] ç¼–è¯‘ PCRE...
cd /d "%ROOT_DIR%dependencies\pcre-8.31"
msbuild pcre-8.31.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\pcre.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] PCRE ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\pcre.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] PCRE ç¼–è¯‘æˆåŠŸ
)
echo.

REM FreeType
echo [2/18] ç¼–è¯‘ FreeType...
cd /d "%ROOT_DIR%dependencies\freetype-2.4.9\builds\win32\vc2010"
msbuild freetype.sln /t:Rebuild /p:Configuration="Release Multithreaded" /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\freetype.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] FreeType ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\freetype.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] FreeType ç¼–è¯‘æˆåŠŸ
)
echo.

REM libogg
echo [3/18] ç¼–è¯‘ libogg...
cd /d "%ROOT_DIR%dependencies\libogg-1.3.2\win32\VS2010"
msbuild libogg_static.sln /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\libogg.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] libogg ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\libogg.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] libogg ç¼–è¯‘æˆåŠŸ
)
echo.

REM libvorbis
echo [4/18] ç¼–è¯‘ libvorbis...
cd /d "%ROOT_DIR%dependencies\libvorbis-1.3.5\win32\VS2010"
msbuild vorbis_static.sln /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\libvorbis.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] libvorbis ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\libvorbis.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] libvorbis ç¼–è¯‘æˆåŠŸ
)
echo.

REM libspeex
echo [5/18] ç¼–è¯‘ libspeex...
cd /d "%ROOT_DIR%dependencies\speex-1.2rc2\win32\VS2008"
msbuild libspeex.sln /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\libspeex.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] libspeex ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\libspeex.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] libspeex ç¼–è¯‘æˆåŠŸ
)
echo.

REM SILLY
echo [6/18] ç¼–è¯‘ SILLY...
cd /d "%ROOT_DIR%dependencies\SILLY-0.1.0\silly"
msbuild SILLY.sln /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\silly.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] SILLY ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\silly.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] SILLY ç¼–è¯‘æˆåŠŸ
)
echo.

REM ========================================
REM ç¬¬äºŒå±‚ï¼šå¹³å°åŸºç¡€åº“
REM ========================================

echo ======== ç¬¬äºŒå±‚ï¼šå¹³å°åŸºç¡€åº“ ========
echo.

REM Lua
echo [7/18] ç¼–è¯‘ Lua...
cd /d "%ROOT_DIR%common\lua"
msbuild lua.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\lua.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] Lua ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\lua.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] Lua ç¼–è¯‘æˆåŠŸ
)
echo.

REM tolua++
echo [8/18] ç¼–è¯‘ tolua++...
cd /d "%ROOT_DIR%common\tolua++-1.0.93\win32\vc7"
msbuild toluapp.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\tolua.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] tolua++ ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\tolua.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] tolua++ ç¼–è¯‘æˆåŠŸ
)
echo.

REM platform
echo [9/18] ç¼–è¯‘ platform...
cd /d "%ROOT_DIR%common\platform"
msbuild platform.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\platform.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] platform ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\platform.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] platform ç¼–è¯‘æˆåŠŸ
)
echo.

REM cauthc
echo [10/18] ç¼–è¯‘ cauthc...
cd /d "%ROOT_DIR%common\cauthc\projects\windows"
msbuild cauthc.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\cauthc.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] cauthc ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\cauthc.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] cauthc ç¼–è¯‘æˆåŠŸ
)
echo.

REM ljfm
echo [11/18] ç¼–è¯‘ ljfm...
cd /d "%ROOT_DIR%common\ljfm"
msbuild ljfm.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\ljfm.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] ljfm ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\ljfm.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] ljfm ç¼–è¯‘æˆåŠŸ
)
echo.

REM ========================================
REM ç¬¬ä¸‰å±‚ï¼šå¼•æ“åº“
REM ========================================

echo ======== ç¬¬ä¸‰å±‚ï¼šå¼•æ“åº“ ========
echo.

REM CEGUI
echo [12/18] ç¼–è¯‘ CEGUI...
cd /d "%ROOT_DIR%dependencies\cegui\project\win32"
msbuild cegui.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\cegui.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] CEGUI ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\cegui.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] CEGUI ç¼–è¯‘æˆåŠŸ
)
echo.

REM Cocos2d-x
echo [13/18] ç¼–è¯‘ Cocos2d-x (è¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´)...
cd /d "%ROOT_DIR%cocos2d-2.0-rc2-x-2.0.1"
msbuild cocos2d-win32.vc2010.sln /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% /m > "%LOG_DIR%\cocos2d.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] Cocos2d-x ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\cocos2d.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] Cocos2d-x ç¼–è¯‘æˆåŠŸ
)
echo.

REM engine
echo [14/18] ç¼–è¯‘ engine...
cd /d "%ROOT_DIR%engine"
msbuild engine.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% > "%LOG_DIR%\engine.log" 2>&1
if %errorlevel% neq 0 (
    echo   [å¤±è´¥] engine ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—: %LOG_DIR%\engine.log
    set /a ERROR_COUNT+=1
) else (
    echo   [æˆåŠŸ] engine ç¼–è¯‘æˆåŠŸ
)
echo.

REM ========================================
REM å®Œæˆ
REM ========================================

echo ========================================
echo ç¼–è¯‘å®Œæˆï¼
echo ========================================
echo.
echo æ€»è®¡é”™è¯¯: %ERROR_COUNT%
echo æ—¥å¿—ç›®å½•: %LOG_DIR%
echo.

if %ERROR_COUNT% equ 0 (
    echo [æˆåŠŸ] æ‰€æœ‰ä¾èµ–åº“ç¼–è¯‘æˆåŠŸï¼
    echo.
    echo ä¸‹ä¸€æ­¥: ç¼–è¯‘ä¸»é¡¹ç›®
    echo   cd client\MT3Win32App
    echo   msbuild mt3.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32
) else (
    echo [è­¦å‘Š] æœ‰ %ERROR_COUNT% ä¸ªåº“ç¼–è¯‘å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ã€‚
    echo.
    echo å¸¸è§é—®é¢˜:
    echo   1. ç¡®ä¿å·²å®‰è£… Visual Studio 2015 (v140 å·¥å…·é›†)
    echo   2. ç¡®ä¿å·²å®‰è£… Windows SDK 10.0.19041.0
    echo   3. æ£€æŸ¥é¡¹ç›®æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
    echo   4. æŸ¥çœ‹å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦ç»†é”™è¯¯
)

echo.
pause
```

**ä½¿ç”¨æ–¹æ³•**:

```batch
REM è¿è¡Œè‡ªåŠ¨åŒ–ç¼–è¯‘
build_all_dependencies.bat
```

---

### 5.3 å¢é‡ç¼–è¯‘è„šæœ¬ï¼ˆåªç¼–è¯‘å¤±è´¥çš„åº“ï¼‰

åˆ›å»ºæ–‡ä»¶: `build_dependencies_incremental.bat`

```batch
@echo off
REM å¢é‡ç¼–è¯‘è„šæœ¬ - åªç¼–è¯‘æŒ‡å®šçš„åº“

setlocal

set ROOT_DIR=%~dp0
set BUILD_CONFIG=Release
set BUILD_PLATFORM=Win32
set TOOLSET=v140

echo è¯·é€‰æ‹©è¦ç¼–è¯‘çš„åº“ï¼š
echo.
echo 1. platform
echo 2. ljfm
echo 3. engine
echo 4. cegui
echo 5. freetype
echo 6. lua
echo 7. cocos2d-x
echo 8. æ‰€æœ‰æ ¸å¿ƒåº“ (platform + ljfm + engine)
echo 9. é€€å‡º
echo.

set /p choice="è¯·è¾“å…¥é€‰æ‹© (1-9): "

if "%choice%"=="1" goto build_platform
if "%choice%"=="2" goto build_ljfm
if "%choice%"=="3" goto build_engine
if "%choice%"=="4" goto build_cegui
if "%choice%"=="5" goto build_freetype
if "%choice%"=="6" goto build_lua
if "%choice%"=="7" goto build_cocos2d
if "%choice%"=="8" goto build_core
if "%choice%"=="9" goto end
goto end

:build_platform
echo ç¼–è¯‘ platform...
cd /d "%ROOT_DIR%common\platform"
msbuild platform.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET%
goto end

:build_ljfm
echo ç¼–è¯‘ ljfm...
cd /d "%ROOT_DIR%common\ljfm"
msbuild ljfm.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET%
goto end

:build_engine
echo ç¼–è¯‘ engine...
cd /d "%ROOT_DIR%engine"
msbuild engine.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET%
goto end

:build_cegui
echo ç¼–è¯‘ CEGUI...
cd /d "%ROOT_DIR%dependencies\cegui\project\win32"
msbuild cegui.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET%
goto end

:build_freetype
echo ç¼–è¯‘ FreeType...
cd /d "%ROOT_DIR%dependencies\freetype-2.4.9\builds\win32\vc2010"
msbuild freetype.sln /t:Rebuild /p:Configuration="Release Multithreaded" /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET%
goto end

:build_lua
echo ç¼–è¯‘ Lua...
cd /d "%ROOT_DIR%common\lua"
msbuild lua.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET%
goto end

:build_cocos2d
echo ç¼–è¯‘ Cocos2d-x (è¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´)...
cd /d "%ROOT_DIR%cocos2d-2.0-rc2-x-2.0.1"
msbuild cocos2d-win32.vc2010.sln /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET% /m
goto end

:build_core
echo ç¼–è¯‘æ‰€æœ‰æ ¸å¿ƒåº“...
echo.
echo [1/3] ç¼–è¯‘ platform...
cd /d "%ROOT_DIR%common\platform"
msbuild platform.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET%
echo.
echo [2/3] ç¼–è¯‘ ljfm...
cd /d "%ROOT_DIR%common\ljfm"
msbuild ljfm.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET%
echo.
echo [3/3] ç¼–è¯‘ engine...
cd /d "%ROOT_DIR%engine"
msbuild engine.win32.vcxproj /t:Rebuild /p:Configuration=%BUILD_CONFIG% /p:Platform=%BUILD_PLATFORM% /p:PlatformToolset=%TOOLSET%
goto end

:end
echo.
echo å®Œæˆï¼
pause
```

---

## 6. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 6.1 ç¼–è¯‘é”™è¯¯ç±»å‹

#### é”™è¯¯ 1: "æ‰¾ä¸åˆ°å¹³å°å·¥å…·é›† v140"

**ç—‡çŠ¶**:
```
error MSB8020: The build tools for v140 (Platform Toolset = 'v140') cannot be found.
```

**è§£å†³æ–¹æ¡ˆ**:
1. å®‰è£… Visual Studio 2015 æˆ–
2. å®‰è£… Visual Studio 2017/2019 çš„ v140 å·¥å…·é›†ç»„ä»¶
3. æˆ–ä¿®æ”¹ä¸ºå½“å‰å·²å®‰è£…çš„å·¥å…·é›†ï¼ˆå¦‚ v141, v142ï¼‰

**ä¿®æ”¹æ–¹æ³•**:
```xml
<PlatformToolset>v142</PlatformToolset>
```

---

#### é”™è¯¯ 2: "æ‰¾ä¸åˆ° Windows SDK"

**ç—‡çŠ¶**:
```
error MSB8036: The Windows SDK version 10.0.19041.0 was not found.
```

**è§£å†³æ–¹æ¡ˆ**:
1. å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ Windows SDK
2. æˆ–ä¿®æ”¹ä¸ºå·²å®‰è£…çš„ç‰ˆæœ¬

**æŸ¥çœ‹å·²å®‰è£…çš„ SDK**:
```batch
dir "C:\Program Files (x86)\Windows Kits\10\Include"
```

**ä¿®æ”¹é¡¹ç›®æ–‡ä»¶**:
```xml
<WindowsTargetPlatformVersion>10.0.17763.0</WindowsTargetPlatformVersion>
```

---

#### é”™è¯¯ 3: "æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å·ï¼ˆä¾ç„¶å­˜åœ¨ï¼‰"

**å¯èƒ½åŸå› **:
1. ä¾èµ–åº“æœªä½¿ç”¨æ­£ç¡®çš„è¿è¡Œæ—¶åº“ç¼–è¯‘
2. ä¾èµ–åº“ç‰ˆæœ¬ä¸åŒ¹é…
3. åº“æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®

**è§£å†³æ­¥éª¤**:
1. ä½¿ç”¨ `dumpbin` æ£€æŸ¥åº“æ–‡ä»¶:
```batch
dumpbin /DIRECTIVES platform.lib | findstr /C:"DEFAULTLIB"
```

æœŸæœ›è¾“å‡ºåº”åŒ…å« `MSVCRT` è€Œä¸æ˜¯ `LIBCMT`:
```
/DEFAULTLIB:"MSVCRT"
/DEFAULTLIB:"OLDNAMES"
```

2. å¦‚æœæ˜¾ç¤º `LIBCMT`ï¼Œè¯´æ˜ä½¿ç”¨äº†é™æ€è¿è¡Œæ—¶åº“ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ã€‚

---

#### é”™è¯¯ 4: "LNK4098: é»˜è®¤åº“"MSVCRT"ä¸å…¶ä»–åº“çš„ä½¿ç”¨å†²çª"

**ç—‡çŠ¶**:
```
warning LNK4098: defaultlib 'MSVCRT' conflicts with use of other libs; use /NODEFAULTLIB:library
```

**è§£å†³æ–¹æ¡ˆ**:
è¿™æ˜¯è¿è¡Œæ—¶åº“æ··ç”¨è­¦å‘Šï¼Œä¸è¦å¿½ç•¥è¯¥è­¦å‘Šï¼

1. æ£€æŸ¥æ‰€æœ‰ä¾èµ–åº“çš„è¿è¡Œæ—¶åº“è®¾ç½®
2. ç»Ÿä¸€ä¸º `/MD` (Release) æˆ– `/MDd` (Debug)
3. ä¸è¦ä½¿ç”¨ `/NODEFAULTLIB` æ¥å¼ºåˆ¶å¿½ç•¥

---

#### é”™è¯¯ 5: "æ— æ³•æ‰“å¼€æ–‡ä»¶'xxx.lib'"

**ç—‡çŠ¶**:
```
error LNK1104: cannot open file 'platform.lib'
```

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤åº“æ–‡ä»¶å·²ç¼–è¯‘ä¸”å­˜åœ¨
2. æ£€æŸ¥åº“æ–‡ä»¶è·¯å¾„é…ç½®
3. æ£€æŸ¥åº“æ–‡ä»¶åæ˜¯å¦æ­£ç¡®

**æ£€æŸ¥å‘½ä»¤**:
```batch
dir /s /b platform.lib
```

---

### 6.2 ç¼–è¯‘æ€§èƒ½ä¼˜åŒ–

#### å¹¶è¡Œç¼–è¯‘

ä½¿ç”¨ `/m` å‚æ•°å¯ç”¨å¤šæ ¸ç¼–è¯‘:
```batch
msbuild solution.sln /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /m:4
```

#### å¢é‡ç¼–è¯‘

å¦‚æœåªä¿®æ”¹äº†éƒ¨åˆ†æ–‡ä»¶ï¼Œä½¿ç”¨ `Build` è€Œä¸æ˜¯ `Rebuild`:
```batch
msbuild solution.sln /t:Build /p:Configuration=Release /p:Platform=Win32
```

---

### 6.3 è°ƒè¯•æŠ€å·§

#### è¯¦ç»†æ—¥å¿—

æ·»åŠ  `/v:detailed` å‚æ•°æŸ¥çœ‹è¯¦ç»†ç¼–è¯‘ä¿¡æ¯:
```batch
msbuild project.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /v:detailed > build.log 2>&1
```

#### æ£€æŸ¥é¢„å¤„ç†å™¨å®

ä½¿ç”¨ `/P` é€‰é¡¹ç”Ÿæˆé¢„å¤„ç†åçš„æ–‡ä»¶:
åœ¨é¡¹ç›®å±æ€§ä¸­:
- C/C++ â†’ é¢„å¤„ç†å™¨ â†’ é¢„å¤„ç†åˆ°æ–‡ä»¶: `æ˜¯`

#### ä½¿ç”¨ Dependency Walker

åˆ†æ `.lib` æ–‡ä»¶çš„ä¾èµ–å…³ç³»:
1. ä¸‹è½½ Dependency Walker (depends.exe)
2. æ‰“å¼€ `.lib` æ–‡ä»¶
3. æŸ¥çœ‹å¯¼å…¥/å¯¼å‡ºçš„ç¬¦å·

---

## 7. éªŒè¯ä¸æµ‹è¯•

### 7.1 éªŒè¯åº“æ–‡ä»¶

åˆ›å»ºéªŒè¯è„šæœ¬: `verify_libs.bat`

```batch
@echo off
setlocal enabledelayedexpansion

set ROOT_DIR=%~dp0
set MISSING_COUNT=0

echo ========================================
echo ä¾èµ–åº“æ–‡ä»¶éªŒè¯
echo ========================================
echo.

REM å®šä¹‰éœ€è¦æ£€æŸ¥çš„åº“æ–‡ä»¶åˆ—è¡¨
set "LIBS[0]=common\platform\Release.win32\platform.lib"
set "LIBS[1]=common\ljfm\Release.win32\ljfm.lib"
set "LIBS[2]=common\lua\Release.win32\lua.lib"
set "LIBS[3]=common\cauthc\projects\windows\Release.win32\cauthc.lib"
set "LIBS[4]=engine\Release.win32\engine.lib"
set "LIBS[5]=dependencies\pcre-8.31\Release.win32\pcre.lib"
set "LIBS[6]=dependencies\cegui\project\win32\Release.win32\cegui.lib"
set "LIBS[7]=cocos2d-2.0-rc2-x-2.0.1\Release.win32\libcocos2d.lib"
set "LIBS[8]=cocos2d-2.0-rc2-x-2.0.1\Release.win32\libCocosDenshion.lib"

set idx=0
:check_loop
if not defined LIBS[%idx%] goto check_done

set lib_path=!LIBS[%idx%]!
if exist "%ROOT_DIR%!lib_path!" (
    echo [OK] !lib_path!
) else (
    echo [MISSING] !lib_path!
    set /a MISSING_COUNT+=1
)

set /a idx+=1
goto check_loop

:check_done
echo.
echo ========================================
if %MISSING_COUNT% equ 0 (
    echo æ‰€æœ‰åº“æ–‡ä»¶éƒ½å­˜åœ¨ï¼
    echo çŠ¶æ€: é€šè¿‡
) else (
    echo ç¼ºå°‘ %MISSING_COUNT% ä¸ªåº“æ–‡ä»¶
    echo çŠ¶æ€: å¤±è´¥
)
echo ========================================

pause
```

---

### 7.2 æ£€æŸ¥è¿è¡Œæ—¶åº“ç±»å‹

åˆ›å»º PowerShell è„šæœ¬: `check_runtime_libs.ps1`

```powershell
# check_runtime_libs.ps1
param(
    [string]$RootPath = "E:\æ¢¦å¹»è¥¿æ¸¸MGåŸç‰ˆæºç "
)

Write-Host "æ£€æŸ¥åº“æ–‡ä»¶çš„è¿è¡Œæ—¶åº“ç±»å‹..." -ForegroundColor Cyan
Write-Host ""

$libFiles = Get-ChildItem -Path $RootPath -Filter "*.lib" -Recurse -File | Where-Object {
    $_.DirectoryName -like "*Release.win32*"
}

$dumpbinPath = "dumpbin.exe"

foreach ($lib in $libFiles) {
    Write-Host "æ£€æŸ¥: $($lib.Name)" -ForegroundColor Yellow
    Write-Host "è·¯å¾„: $($lib.FullName)" -ForegroundColor Gray

    $output = & $dumpbinPath /DIRECTIVES $lib.FullName 2>&1 | Out-String

    if ($output -match "DEFAULTLIB.*MSVCRT") {
        Write-Host "  è¿è¡Œæ—¶åº“: åŠ¨æ€é“¾æ¥ (/MD) - æ­£ç¡®" -ForegroundColor Green
    } elseif ($output -match "DEFAULTLIB.*LIBCMT") {
        Write-Host "  è¿è¡Œæ—¶åº“: é™æ€é“¾æ¥ (/MT) - éœ€è¦é‡æ–°ç¼–è¯‘!" -ForegroundColor Red
    } else {
        Write-Host "  è¿è¡Œæ—¶åº“: æœªçŸ¥" -ForegroundColor Yellow
    }

    Write-Host ""
}
```

---

### 7.3 æµ‹è¯•ä¸»é¡¹ç›®ç¼–è¯‘

åœ¨æ‰€æœ‰ä¾èµ–åº“ç¼–è¯‘å®Œæˆåï¼Œæµ‹è¯•ä¸»é¡¹ç›®:

```batch
cd client\MT3Win32App

REM æ¸…ç†
msbuild mt3.win32.vcxproj /t:Clean /p:Configuration=Release /p:Platform=Win32

REM ç¼–è¯‘
msbuild mt3.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 > build_mt3.log 2>&1

REM æ£€æŸ¥ç»“æœ
if %errorlevel% equ 0 (
    echo ç¼–è¯‘æˆåŠŸï¼
    dir Release.win32\MT3.exe
) else (
    echo ç¼–è¯‘å¤±è´¥ï¼Œè¯·æŸ¥çœ‹ build_mt3.log
    type build_mt3.log | findstr /C:"error"
)
```

---

## 8. é™„å½•

### 8.1 å¿«é€Ÿå‚è€ƒ

#### è¿è¡Œæ—¶åº“é€‰é¡¹å¯¹ç…§è¡¨

| é€‰é¡¹ | è¯´æ˜ | å¯¹åº”åº“ | ç”¨é€” |
|------|------|--------|------|
| /MT | å¤šçº¿ç¨‹é™æ€ | libcmt.lib | Release é™æ€é“¾æ¥ |
| /MTd | å¤šçº¿ç¨‹è°ƒè¯•é™æ€ | libcmtd.lib | Debug é™æ€é“¾æ¥ |
| /MD | å¤šçº¿ç¨‹ DLL | msvcrt.lib | Release åŠ¨æ€é“¾æ¥ |
| /MDd | å¤šçº¿ç¨‹è°ƒè¯• DLL | msvcrtd.lib | Debug åŠ¨æ€é“¾æ¥ |

**æœ¬é¡¹ç›®ç»Ÿä¸€ä½¿ç”¨**: `/MD` (Release) å’Œ `/MDd` (Debug)

---

#### MSBuild å¸¸ç”¨å‚æ•°

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| /t:Target | æŒ‡å®šç¼–è¯‘ç›®æ ‡ | `/t:Rebuild` |
| /p:Property=Value | è®¾ç½®å±æ€§ | `/p:Configuration=Release` |
| /m[:N] | å¹¶è¡Œç¼–è¯‘ | `/m:4` |
| /v:Level | æ—¥å¿—çº§åˆ« | `/v:detailed` |
| /fl | è¾“å‡ºåˆ°æ–‡ä»¶ | `/fl /flp:logfile=build.log` |

---

### 8.2 ç›¸å…³æ–‡æ¡£

- [Visual C++ è¿è¡Œæ—¶åº“](https://docs.microsoft.com/en-us/cpp/c-runtime-library/)
- [MSBuild å‚è€ƒ](https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild-reference)
- [é“¾æ¥å™¨é€‰é¡¹](https://docs.microsoft.com/en-us/cpp/build/reference/linker-options)

---

### 8.3 å·¥å…·æ¸…å•

- **Visual Studio 2015**: C++ ç¼–è¯‘å™¨å’Œå·¥å…·é“¾
- **Windows SDK 8.1**: Windows å¹³å°å¼€å‘å¥—ä»¶
- **MSBuild**: è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·
- **PowerShell**: è„šæœ¬è‡ªåŠ¨åŒ–
- **Dependency Walker**: ä¾èµ–åˆ†æå·¥å…· (å¯é€‰)
- **dumpbin**: åº“æ–‡ä»¶åˆ†æå·¥å…· (éš VS å®‰è£…)

---

## 9. æ€»ç»“

### 9.1 å…³é”®è¦ç‚¹

1. âœ… **ç»Ÿä¸€è¿è¡Œæ—¶åº“**: æ‰€æœ‰åº“å¿…é¡»ä½¿ç”¨ç›¸åŒçš„è¿è¡Œæ—¶åº“ (`/MD` æˆ– `/MDd`)
2. âœ… **ç»Ÿä¸€å·¥å…·é›†**: ä½¿ç”¨ç›¸åŒçš„å¹³å°å·¥å…·é›† (`v140`)
3. âœ… **æŒ‰é¡ºåºç¼–è¯‘**: éµå¾ªä¾èµ–å…³ç³»ï¼Œä»åº•å±‚åˆ°ä¸Šå±‚
4. âœ… **éªŒè¯è¾“å‡º**: ç¼–è¯‘åæ£€æŸ¥åº“æ–‡ä»¶æ˜¯å¦æ­£ç¡®ç”Ÿæˆ
5. âœ… **ä¿ç•™æ—¥å¿—**: ç¼–è¯‘æ—¥å¿—ç”¨äºé—®é¢˜è¯Šæ–­

### 9.2 æ¨èæµç¨‹

```
1. è¿è¡Œ fix_all_vcxproj_runtime.ps1 ä¿®å¤é…ç½®
2. è¿è¡Œ build_all_dependencies.bat ç¼–è¯‘æ‰€æœ‰åº“
3. è¿è¡Œ verify_libs.bat éªŒè¯åº“æ–‡ä»¶
4. ç¼–è¯‘ä¸»é¡¹ç›® MT3
5. æµ‹è¯•è¿è¡Œ
```

### 9.3 é¢„è®¡è€—æ—¶

- é…ç½®ä¿®å¤: 5-10 åˆ†é’Ÿ
- å…¨é‡ç¼–è¯‘: 30-60 åˆ†é’Ÿï¼ˆå–å†³äºç¡¬ä»¶ï¼‰
- å¢é‡ç¼–è¯‘: 5-15 åˆ†é’Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-10-21
**ç»´æŠ¤è€…**: Claude Code

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦æ›´æ–°ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿã€‚

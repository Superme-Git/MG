# MT3项目 - 关键依赖库编译进度与说明

## 📅 编译信息

- **编译日期**: 2025-10-12
- **编译工具**: Visual Studio 2019 MSBuild
- **目标工具集**: v140 (Visual Studio 2015)
- **配置**: Release
- **平台**: Win32

## 🎯 编译目标库列表

按照依赖关系顺序，需要编译以下关键库：

### 第一层：基础库

| 序号 | 库名 | 状态 | 输出文件 | 说明 |
|------|------|------|----------|------|
| 1 | lua | 待编译 | common\lua\Release.win32\lua.lib | Lua脚本引擎 |
| 2 | platform | 待编译 | common\platform\Release.win32\platform.lib | 平台抽象层 |
| 3 | ljfm | 待编译 | common\ljfm\Release.win32\ljfm.lib | 文件管理库 |
| 4 | cauthc | 待编译 | common\cauthc\projects\windows\Release.win32\cauthc.lib | 认证库 |

### 第二层：UI和图形库

| 序号 | 库名 | 状态 | 输出文件 | 说明 |
|------|------|------|----------|------|
| 5 | cegui | 待编译 | dependencies\cegui\project\win32\Release.win32\cegui.lib | UI框架 |
| 6 | freetype | 待编译 | dependencies\freetype-2.4.9\objs\win32\vc2010\freetype249MT.lib | 字体渲染 |
| 7 | pcre | 待编译 | dependencies\pcre-8.31\Release.win32\pcre.lib | 正则表达式 |
| 8 | silly | 待编译 | dependencies\SILLY-0.1.0\Release.win32\silly.lib | 图像加载 |

### 第三层：游戏引擎

| 序号 | 库名 | 状态 | 输出文件 | 说明 |
|------|------|------|----------|------|
| 9 | cocos2d-x | 待编译 | cocos2d-2.0-rc2-x-2.0.1\Release.win32\libcocos2d.lib | 游戏引擎核心 |
| 10 | CocosDenshion | 待编译 | cocos2d-2.0-rc2-x-2.0.1\Release.win32\libCocosDenshion.lib | 音频引擎 |
| 11 | libSpine | 待编译 | cocos2d-2.0-rc2-x-2.0.1\Release.win32\libSpine.lib | 骨骼动画 |
| 12 | engine | 待编译 | engine\Release.win32\engine.lib | 游戏引擎扩展 |

### 第四层：客户端库

| 序号 | 库名 | 状态 | 输出文件 | 说明 |
|------|------|------|----------|------|
| 13 | FireClient | 待编译 | client\FireClient\Release.win32\FireClient.lib | 客户端库 |

## 🔧 编译脚本说明

已创建以下编译脚本：

### 主脚本
- **build_all_steps.bat** - 按顺序编译所有关键库（推荐使用）

### 单步脚本
- **build_step1_freetype.bat** - 单独编译 FreeType
- **build_step2_lua.bat** - 单独编译 Lua
- **build_step3_platform.bat** - 单独编译 platform
- **build_step4_ljfm.bat** - 单独编译 ljfm
- **build_step5_cegui.bat** - 单独编译 CEGUI
- **build_step6_cocos2d.bat** - 单独编译 Cocos2d-x
- **build_step7_engine.bat** - 单独编译 engine

## 📝 使用说明

### 方式一：自动编译所有库（推荐）

```batch
cd E:\梦幻西游MG原版源码
build_all_steps.bat
```

### 方式二：逐个编译

```batch
cd E:\梦幻西游MG原版源码

REM 第1步：编译 Lua
build_step2_lua.bat

REM 第2步：编译 platform
build_step3_platform.bat

REM 第3步：编译 ljfm
build_step4_ljfm.bat

REM 第4步：编译 CEGUI
build_step5_cegui.bat

REM 第5步：编译 Cocos2d-x
build_step6_cocos2d.bat

REM 第6步：编译 engine
build_step7_engine.bat
```

### 方式三：手动使用 MSBuild

```batch
set MSBUILD="C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Current\Bin\MSBuild.exe"

REM 编译 platform
cd common\platform
%MSBUILD% platform.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /nologo

REM 编译 ljfm
cd ..\ljfm
%MSBUILD% ljfm.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /nologo

REM 编译 engine
cd ..\..\engine
%MSBUILD% engine.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /nologo
```

## ⚠️ 注意事项

### 1. 编译前提条件

- ✅ 已安装 Visual Studio 2019 Build Tools
- ✅ 已安装 v140 平台工具集（Visual Studio 2015工具集）
- ✅ 已安装 Windows SDK 10.0
- ✅ MSBuild 路径正确: `C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Current\Bin\MSBuild.exe`

### 2. 常见问题

#### 问题 1: "找不到 MSBuild.exe"
**解决方案**:
- 检查 Visual Studio 2019 Build Tools 是否已安装
- 确认 MSBuild.exe 路径是否正确
- 修改脚本中的 `MSBUILD` 变量为实际路径

#### 问题 2: "找不到平台工具集 v140"
**解决方案**:
- 在 Visual Studio Installer 中安装 "MSVC v140 - VS 2015 C++ 生成工具"
- 或者修改脚本，将 `v140` 改为 `v142` (VS 2019) 或其他已安装的工具集

#### 问题 3: "无法解析的外部符号"
**解决方案**:
- 确保所有依赖库按顺序编译
- 检查运行时库设置是否统一为 `/MD`
- 参考 [第三方依赖库重新编译完全指南.md](第三方依赖库重新编译完全指南.md)

### 3. 编译顺序很重要！

必须按照以下顺序编译：
1. 基础库 (lua, platform, ljfm, cauthc)
2. UI库 (cegui 及其依赖)
3. 引擎库 (cocos2d-x)
4. 扩展库 (engine)
5. 客户端库 (FireClient)

## 📊 编译时间估算

| 库 | 预计时间 |
|------|----------|
| lua | 1-2 分钟 |
| platform | 2-3 分钟 |
| ljfm | 2-3 分钟 |
| cauthc | 1-2 分钟 |
| cegui | 3-5 分钟 |
| cocos2d-x | 10-15 分钟 |
| engine | 5-8 分钟 |
| **总计** | **约 30-40 分钟** |

## 🔍 验证编译结果

编译完成后，运行以下命令验证：

```batch
cd E:\梦幻西游MG原版源码

REM 检查关键库文件
dir common\platform\Release.win32\platform.lib
dir common\ljfm\Release.win32\ljfm.lib
dir engine\Release.win32\engine.lib
dir dependencies\cegui\project\win32\Release.win32\cegui.lib
dir cocos2d-2.0-rc2-x-2.0.1\Release.win32\libcocos2d.lib
```

所有库文件都应该存在且大小大于 0。

## 📦 下一步

依赖库编译完成后，编译主项目：

```batch
cd client\MT3Win32App
msbuild mt3.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /nologo
```

如果主项目编译成功，可执行文件位于：
```
client\Release.win32\MT3.exe
```

## 📚 相关文档

- [MT3项目编译问题分析与解决方案.md](MT3项目编译问题分析与解决方案.md)
- [第三方依赖库重新编译完全指南.md](第三方依赖库重新编译完全指南.md)

## 📞 支持

如遇到编译问题，请查看：
1. 编译日志文件（如果有）
2. 相关文档中的"常见问题与解决方案"章节
3. 错误信息中的具体错误代码

---

**最后更新**: 2025-10-12
**文档版本**: 1.0

# MT3é¡¹ç›® v140 å®Œæ•´ç¼–è¯‘æ‰§è¡Œè¯´æ˜

**æ—¥æœŸ**: 2025-10-13
**ç›®æ ‡**: ä½¿ç”¨v140å·¥å…·é›†å®ŒæˆMT3.exeçš„å®Œæ•´ç¼–è¯‘å’ŒéªŒè¯

---

## ğŸ“‹ æ‰§è¡Œæ¦‚è¿°

æœ¬æ¬¡ä»»åŠ¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™:

1. âœ… **ç»Ÿä¸€çš„å¹³å°å·¥å…·é›†**: æ‰€æœ‰åº“ä½¿ç”¨ v140 (VS2015) ç¼–è¯‘
2. âœ… **ç»Ÿä¸€çš„è¿è¡Œæ—¶åº“**: æ‰€æœ‰åº“ä½¿ç”¨ `/MD` (MultiThreadedDLL)
3. âœ… **åˆ†ææ•´ç†ç¼–è¯‘é¡ºåº**: æŒ‰ç…§4å±‚ä¾èµ–æ¶æ„é¡ºåºç¼–è¯‘
4. âš ï¸ **ä¸å¯ä»¥å¿½ç•¥æ ‡å‡†åº“**: **ç»å¯¹ä¸å¿½ç•¥ msvcrt.lib**

---

## ğŸ—ï¸ ç¼–è¯‘æ¶æ„ (4å±‚ä¾èµ–ç»“æ„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: åº”ç”¨ç¨‹åºå±‚                      â”‚
â”‚  - FireClient.lib (æ¸¸æˆé€»è¾‘)             â”‚
â”‚  - MT3.exe (ä¸»ç¨‹åº)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘ ä¾èµ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: æ¸¸æˆå¼•æ“æ‰©å±•å±‚                  â”‚
â”‚  - engine.lib (MT3å¼•æ“æ‰©å±•)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘ ä¾èµ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: Cocos2då¼•æ“å±‚                  â”‚
â”‚  - libcocos2d.dll (2Då¼•æ“)              â”‚
â”‚  - libCocosDenshion.dll (éŸ³é¢‘)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘ ä¾èµ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: åŸºç¡€åº“å±‚ (æ— ç›¸äº’ä¾èµ–)            â”‚
â”‚  - platform.lib (å¹³å°æŠ½è±¡)               â”‚
â”‚  - ljfm.lib (æ–‡ä»¶ç®¡ç†)                   â”‚
â”‚  - lua.lib (è„šæœ¬å¼•æ“)                    â”‚
â”‚  - cauthc.lib (è®¤è¯åº“)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å·²åˆ›å»ºçš„è„šæœ¬æ–‡ä»¶

### 1. ä¸»ç¼–è¯‘è„šæœ¬
**æ–‡ä»¶**: `build_mt3_v140_final.bat`

**åŠŸèƒ½**:
- æŒ‰æ­£ç¡®é¡ºåºç¼–è¯‘æ‰€æœ‰9ä¸ªç»„ä»¶
- è‡ªåŠ¨éªŒè¯ç¼–è¯‘ç»“æœ
- æ˜¾ç¤ºæ–‡ä»¶å¤§å°å’ŒçŠ¶æ€
- å¤åˆ¶è¿è¡Œæ—¶DLLåˆ°binç›®å½•

**ä½¿ç”¨æ–¹æ³•**:
```batch
cd e:\æ¢¦å¹»è¥¿æ¸¸MGåŸç‰ˆæºç 
build_mt3_v140_final.bat
```

### 2. æµ‹è¯•éªŒè¯è„šæœ¬
**æ–‡ä»¶**: `test_mt3_build.bat`

**åŠŸèƒ½**:
- æ£€æŸ¥æ‰€æœ‰ç¼–è¯‘è¾“å‡ºæ–‡ä»¶
- ä½¿ç”¨dumpbinåˆ†æä¾èµ–é¡¹
- éªŒè¯è¿è¡Œæ—¶åº“é“¾æ¥
- å¤åˆ¶æ–‡ä»¶åˆ°è¿è¡Œç›®å½•
- è®¡ç®—MD5æ ¡éªŒå’Œ

**ä½¿ç”¨æ–¹æ³•**:
```batch
cd e:\æ¢¦å¹»è¥¿æ¸¸MGåŸç‰ˆæºç 
test_mt3_build.bat
```

### 3. é…ç½®æ–‡æ¡£
**æ–‡ä»¶**: `doc\v140ç¼–è¯‘é…ç½®è¯´æ˜.md`

**å†…å®¹**:
- æ ¸å¿ƒç¼–è¯‘åŸåˆ™
- è¯¦ç»†çš„ç¼–è¯‘é¡ºåº
- MSBuildå‘½ä»¤æ¨¡æ¿
- å¸¸è§é”™è¯¯è§£å†³æ–¹æ¡ˆ
- éªŒè¯æ¸…å•

---

## ğŸ”‘ å…³é”®é…ç½®è¦ç‚¹

### 1. ä¸å¿½ç•¥æ ‡å‡†åº“ (æœ€é‡è¦!)

**æ­£ç¡®é…ç½®** âœ…:
```xml
<IgnoreSpecificDefaultLibraries>libcmt.lib;libcmtd.lib</IgnoreSpecificDefaultLibraries>
```

**é”™è¯¯é…ç½®** âŒ:
```xml
<!-- åƒä¸‡ä¸è¦è¿™æ ·! -->
<IgnoreSpecificDefaultLibraries>libcmt.lib;libcmtd.lib;msvcrt.lib</IgnoreSpecificDefaultLibraries>
```

**åŸå› **:
- `msvcrt.lib` æ˜¯ `/MD` è¿è¡Œæ—¶çš„**æ ¸å¿ƒåº“**
- å¿½ç•¥å®ƒä¼šå¯¼è‡´æ•°åƒä¸ªé“¾æ¥é”™è¯¯ (LNK2001)
- åªåº”è¯¥å¿½ç•¥**é™æ€**è¿è¡Œæ—¶åº“ (libcmt.lib, libcmtd.lib)

### 2. ç»Ÿä¸€è¿è¡Œæ—¶åº“

æ‰€æœ‰é¡¹ç›®å¿…é¡»ä½¿ç”¨:
```xml
<RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>  <!-- Release -->
<RuntimeLibrary>MultiThreadedDebugDLL</RuntimeLibrary>  <!-- Debug -->
```

### 3. ç»Ÿä¸€å¹³å°å·¥å…·é›†

æ‰€æœ‰é¡¹ç›®å¿…é¡»ä½¿ç”¨:
```xml
<PlatformToolset>v140</PlatformToolset>
```

---

## ğŸ“Š ç¼–è¯‘é¡ºåºè¯¦è§£

### ç¬¬ä¸€å±‚: åŸºç¡€åº“ (å¯å¹¶è¡Œ)
1. **platform.lib** - 1.5 MB
   ```batch
   msbuild common\platform\platform.editor.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
   ```

2. **ljfm.lib** - 1.3 MB
   ```batch
   msbuild common\ljfm\ljfm.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
   ```

3. **lua.lib** - 4.1 MB
   ```batch
   msbuild common\lua\lua.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
   ```

4. **cauthc.lib** - 23 MB
   ```batch
   msbuild common\cauthc\projects\windows\cauthc.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
   ```

### ç¬¬äºŒå±‚: Cocos2då¼•æ“ (ä¾èµ–Layer 1)
5. **libcocos2d.dll** - 1.4 MB (DLL) + 2.1 MB (LIB)
   ```batch
   msbuild cocos2d-2.0-rc2-x-2.0.1\cocos2dx\proj.win32\cocos2d-win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
   ```

6. **libCocosDenshion.dll** - 45 KB
   ```batch
   msbuild cocos2d-2.0-rc2-x-2.0.1\CocosDenshion\proj.win32\CocosDenshion.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
   ```

### ç¬¬ä¸‰å±‚: æ¸¸æˆå¼•æ“ (ä¾èµ–Layer 1+2)
7. **engine.lib** - 37 MB (æœ€å¤§çš„åº“)
   ```batch
   msbuild engine\engine.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
   ```

### ç¬¬å››å±‚: åº”ç”¨ç¨‹åº (ä¾èµ–æ‰€æœ‰)
8. **FireClient.lib** - æ¸¸æˆé€»è¾‘
   ```batch
   msbuild client\FireClient\FireClient.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
   ```

9. **MT3.exe** - ä¸»ç¨‹åº (çº¦8-10 MB)
   ```batch
   msbuild client\MT3Win32App\mt3.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
   ```

---

## âœ… éªŒè¯æ¸…å•

ç¼–è¯‘å®Œæˆå,æ£€æŸ¥ä»¥ä¸‹æ–‡ä»¶:

### åŸºç¡€åº“
- [ ] `common\platform\Release.win32\platform.lib` (1.5 MB)
- [ ] `common\ljfm\Release.win32\ljfm.lib` (1.3 MB)
- [ ] `common\lua\Release.win32\lua.lib` (4.1 MB)
- [ ] `common\cauthc\projects\windows\Release.win32\cauthc.lib` (23 MB)

### Cocos2då¼•æ“
- [ ] `cocos2d-2.0-rc2-x-2.0.1\Release.win32\libcocos2d.dll` (1.4 MB)
- [ ] `cocos2d-2.0-rc2-x-2.0.1\Release.win32\libcocos2d.lib` (2.1 MB)
- [ ] `cocos2d-2.0-rc2-x-2.0.1\Release.win32\libCocosDenshion.dll` (45 KB)

### æ¸¸æˆå¼•æ“
- [ ] `engine\Release.win32\engine.lib` (37 MB)

### åº”ç”¨ç¨‹åº
- [ ] `client\FireClient\Release.win32\FireClient.lib`
- [ ] `client\MT3Win32App\Release.win32\MT3.exe` (8-10 MB)
- [ ] `client\resource\bin\Release\MT3.exe` (PostBuildå¤åˆ¶)

---

## ğŸš€ æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤1: æ¸…ç†æ—§æ–‡ä»¶ (å¯é€‰)
```batch
cd e:\æ¢¦å¹»è¥¿æ¸¸MGåŸç‰ˆæºç 
rmdir /s /q client\MT3Win32App\Release.win32
rmdir /s /q client\FireClient\Release.win32
rmdir /s /q engine\Release.win32
rmdir /s /q cocos2d-2.0-rc2-x-2.0.1\Release.win32
```

### æ­¥éª¤2: æ‰§è¡Œå®Œæ•´ç¼–è¯‘
```batch
build_mt3_v140_final.bat
```

**é¢„è®¡æ—¶é—´**: 15-20åˆ†é’Ÿ
**è¾“å‡º**: 9ä¸ªç»„ä»¶æŒ‰é¡ºåºç¼–è¯‘

### æ­¥éª¤3: éªŒè¯ç¼–è¯‘ç»“æœ
```batch
test_mt3_build.bat
```

**æ£€æŸ¥**:
- æ‰€æœ‰æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- æ–‡ä»¶å¤§å°æ˜¯å¦åˆç†
- ä¾èµ–é¡¹æ˜¯å¦æ­£ç¡®
- è¿è¡Œæ—¶åº“æ˜¯å¦æ­£ç¡®é“¾æ¥

### æ­¥éª¤4: è¿è¡Œæµ‹è¯•
```batch
cd client\resource\bin\Release
MT3.exe
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç¼–è¯‘å¤±è´¥,å‡ºç°LNK2001é”™è¯¯
**æ£€æŸ¥**:
1. æ˜¯å¦å¿½ç•¥äº† `msvcrt.lib`?
2. è¿è¡Œæ—¶åº“æ˜¯å¦ç»Ÿä¸€ä¸º `/MD`?
3. ä¾èµ–åº“æ˜¯å¦å·²ç»ç¼–è¯‘?

**è§£å†³**:
```batch
# æ£€æŸ¥é¡¹ç›®é…ç½®
findstr "IgnoreSpecificDefaultLibraries" client\MT3Win32App\mt3.win32.vcxproj
# åº”è¯¥åªçœ‹åˆ°: libcmt.lib;libcmtd.lib
```

### é—®é¢˜2: MT3.exeæ— æ³•è¿è¡Œ,ç¼ºå°‘DLL
**æ£€æŸ¥**:
```batch
# æ£€æŸ¥DLLæ˜¯å¦å¤åˆ¶
dir client\resource\bin\Release\*.dll
```

**è§£å†³**:
```batch
# æ‰‹åŠ¨å¤åˆ¶DLL
xcopy /Y /Q cocos2d-2.0-rc2-x-2.0.1\Release.win32\*.dll client\resource\bin\Release\
```

### é—®é¢˜3: ç¼–è¯‘éå¸¸æ…¢
**ä¼˜åŒ–**:
- ç¡®ä¿ä½¿ç”¨äº† `/m` å‚æ•° (å¤šæ ¸ç¼–è¯‘)
- å…³é—­æ€æ¯’è½¯ä»¶ä¸´æ—¶æ’é™¤é¡¹ç›®ç›®å½•
- ä½¿ç”¨SSDè€Œä¸æ˜¯HDD

### é—®é¢˜4: è¿è¡Œæ—¶å´©æºƒ
**æ£€æŸ¥**:
```batch
# åˆ†æä¾èµ–é¡¹
dumpbin /DEPENDENTS client\MT3Win32App\Release.win32\MT3.exe

# åº”è¯¥çœ‹åˆ° msvcr140.dll æˆ– VCRUNTIME140.dll
```

**è§£å†³**:
å®‰è£… Visual C++ 2015 Redistributable

---

## ğŸ“ˆ é¢„æœŸç»“æœ

### ç¼–è¯‘æˆåŠŸæ ‡å¿—
1. âœ… æ‰€æœ‰9ä¸ªç»„ä»¶æ— é”™è¯¯ç¼–è¯‘
2. âœ… è¾“å‡ºæ–‡ä»¶å¤§å°åˆç†
3. âœ… PostBuildäº‹ä»¶æˆåŠŸæ‰§è¡Œ
4. âœ… DLLæ–‡ä»¶æ­£ç¡®å¤åˆ¶

### æ€»æ–‡ä»¶å¤§å°
- **æ€»åº“å¤§å°**: çº¦ 69 MB
- **MT3.exe**: çº¦ 8-10 MB
- **DLLæ–‡ä»¶**: çº¦ 1.5 MB

### è¿è¡Œæ—¶ä¾èµ–
- `msvcr140.dll` (v140 Cè¿è¡Œæ—¶)
- `VCRUNTIME140.dll` (v140 C++è¿è¡Œæ—¶)
- `libcocos2d.dll`
- `libCocosDenshion.dll`
- Windowsç³»ç»ŸDLL

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

1. **ç¼–è¯‘æˆåŠŸ**: æ‰€æœ‰ç»„ä»¶é›¶é”™è¯¯ç¼–è¯‘
2. **æ–‡ä»¶éªŒè¯**: æ‰€æœ‰è¾“å‡ºæ–‡ä»¶å­˜åœ¨ä¸”å¤§å°åˆç†
3. **ä¾èµ–æ­£ç¡®**: MT3.exeé“¾æ¥åˆ°v140è¿è¡Œæ—¶
4. **èƒ½å¤Ÿè¿è¡Œ**: MT3.exeæˆåŠŸå¯åŠ¨(å³ä½¿å´©æºƒä¹Ÿç®—åˆæ­¥æˆåŠŸ)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [v140ç¼–è¯‘é…ç½®è¯´æ˜.md](doc/v140ç¼–è¯‘é…ç½®è¯´æ˜.md) - è¯¦ç»†é…ç½®è¯´æ˜
- [ç¼–è¯‘æˆåŠŸæŠ¥å‘Š.md](doc/ç¼–è¯‘æˆåŠŸæŠ¥å‘Š.md) - ç¬¬ä¸‰æ–¹åº“ç¼–è¯‘æŠ¥å‘Š
- [æœ€ç»ˆå¯ç”¨æ–¹æ¡ˆ.md](æœ€ç»ˆå¯ç”¨æ–¹æ¡ˆ.md) - v120åŸå§‹ç‰ˆæœ¬å¯¹æ¯”

---

## ğŸ’¡ ç»éªŒæ€»ç»“

### æˆåŠŸå…³é”®å› ç´ 
1. **ç»Ÿä¸€å·¥å…·é›†**: v140 across all projects
2. **ç»Ÿä¸€è¿è¡Œæ—¶**: /MD for all projects
3. **æ­£ç¡®é¡ºåº**: 4-layer dependency hierarchy
4. **ä¸å¿½ç•¥æ ‡å‡†åº“**: msvcrt.lib is essential!

### ä¸v120å¯¹æ¯”
| æ–¹é¢ | v120 (åŸå§‹) | v140 (æœ¬æ¬¡) |
|------|-------------|-------------|
| å·¥å…·é›† | VS2013 | VS2015 |
| è¿è¡Œæ—¶ | msvcr120.dll | msvcr140.dll |
| ä¼˜åŒ– | Debug | Release |
| å¤§å° | 23 MB | 8-10 MB |
| çŠ¶æ€ | âœ… ç¨³å®šè¿è¡Œ | ğŸ”„ ç¼–è¯‘æµ‹è¯•ä¸­ |

---

**åˆ›å»ºæ—¶é—´**: 2025-10-13
**æ‰§è¡ŒçŠ¶æ€**: ğŸ”„ ç¼–è¯‘è¿›è¡Œä¸­
**ä¸‹ä¸€æ­¥**: ç­‰å¾…ç¼–è¯‘å®Œæˆå¹¶éªŒè¯ç»“æœ

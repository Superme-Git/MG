# MT3 é¡¹ç›® VS2015 å…¼å®¹æ€§è¡¥ä¸è¯´æ˜

## ğŸ“Œ é—®é¢˜æ¦‚è¿°

åœ¨ä½¿ç”¨ Visual Studio 2015 ç¼–è¯‘ MT3 é¡¹ç›®(åŸºäº Cocos2d-x 2.0.1)æ—¶,ä¼šé‡åˆ°å¤šä¸ªå…¼å®¹æ€§é—®é¢˜ã€‚æœ¬æ–‡æ¡£è®°å½•äº†æ‰€æœ‰å¿…è¦çš„ä¿®å¤ã€‚

---

## ğŸ”§ è¡¥ä¸åˆ—è¡¨

### è¡¥ä¸ 1: SimpleAudioEngine å¤´æ–‡ä»¶è·¯å¾„ä¿®å¤

**æ–‡ä»¶**: `client/MT3Win32App/SimpleAudioEngineAdapter.cpp`

**é—®é¢˜**: C1083 - æ— æ³•æ‰“å¼€åŒ…æ‹¬æ–‡ä»¶

**åŸå§‹ä»£ç **:
```cpp
#include "CocosDenshion/Include/SimpleAudioEngine.h"
```

**ä¿®å¤å**:
```cpp
#include "SimpleAudioEngine.h"
```

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### è¡¥ä¸ 2: pthread.h timespec é‡å®šä¹‰ä¿®å¤

**æ–‡ä»¶**: `cocos2d-2.0-rc2-x-2.0.1/cocos2dx/platform/third_party/win32/pthread/pthread.h`

**é—®é¢˜**: C2011 - `timespec` ç»“æ„ä½“é‡å®šä¹‰

**æ ¹æœ¬åŸå› **:
- VS2015 åœ¨ `<time.h>` ä¸­å·²ç»å®šä¹‰äº† `struct timespec`
- pthread åº“ä¹Ÿå®šä¹‰äº† `struct timespec`
- å¯¼è‡´é‡å¤å®šä¹‰å†²çª

**ä¿®å¤ä½ç½®**: ç¬¬ 305-317 è¡Œ

**åŸå§‹ä»£ç **:
```c
#ifndef HAVE_STRUCT_TIMESPEC
#define HAVE_STRUCT_TIMESPEC
struct timespec {
    long tv_sec;
    long tv_nsec;
};
#endif /* HAVE_STRUCT_TIMESPEC */
```

**ä¿®å¤å**:
```c
// é˜²æ­¢timespecç»“æ„ä½“é‡å¤å®šä¹‰
// VS2015åŠä»¥ä¸Šç‰ˆæœ¬åœ¨time.hä¸­å·²ç»å®šä¹‰äº†timespec
// éœ€è¦æ£€æŸ¥å¤šä¸ªå¯èƒ½å·²ç»å®šä¹‰timespecçš„å®
#ifndef HAVE_STRUCT_TIMESPEC
#if !defined(_TIMESPEC_DEFINED) && !defined(_INC_TIME) && !defined(TIMESPEC_DEFINED) && (_MSC_VER < 1900)
// VS2015ä¹‹å‰çš„ç‰ˆæœ¬éœ€è¦å®šä¹‰timespec
#define PTW32_TIMESPEC_DEFINED
#define HAVE_STRUCT_TIMESPEC 1
struct timespec {
	long tv_sec;
	long tv_nsec;
};
#endif /* VS2015ä¹‹å‰çš„ç‰ˆæœ¬ */
#endif /* !HAVE_STRUCT_TIMESPEC */
```

**å…³é”®æ”¹åŠ¨**:
1. æ·»åŠ  `_MSC_VER < 1900` æ£€æŸ¥(1900 = VS2015)
2. æ·»åŠ é¢å¤–çš„å®æ£€æŸ¥ `_TIMESPEC_DEFINED` å’Œ `TIMESPEC_DEFINED`
3. åªåœ¨ VS2015 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å®šä¹‰ `timespec`

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### è¡¥ä¸ 3: CRT è¿è¡Œæ—¶åº“å†²çªä¿®å¤

**æ–‡ä»¶**: `client/MT3Win32App/mt3.win32.vcxproj`

**é—®é¢˜**: LNK2005/LNK1169 - å¤šé‡å®šä¹‰ç¬¦å·,CRT åº“å†²çª

**ä¿®å¤å†…å®¹**:

**Debug é…ç½®**:
```xml
<RuntimeLibrary>MultiThreadedDebugDLL</RuntimeLibrary>
<AdditionalDependencies>legacy_stdio_definitions.lib;%(AdditionalDependencies)</AdditionalDependencies>
<IgnoreSpecificDefaultLibraries>libcmtd.lib</IgnoreSpecificDefaultLibraries>
```

**Release é…ç½®**:
```xml
<RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>
<AdditionalDependencies>legacy_stdio_definitions.lib;%(AdditionalDependencies)</AdditionalDependencies>
<IgnoreSpecificDefaultLibraries>libcmt.lib</IgnoreSpecificDefaultLibraries>
```

**å…³é”®ç‚¹**:
- ä½¿ç”¨åŠ¨æ€ CRT (`MultiThreadedDLL` / `MultiThreadedDebugDLL`)
- é“¾æ¥ `legacy_stdio_definitions.lib` (VS2015 å…¼å®¹åº“)
- å¿½ç•¥é™æ€ CRT åº“(`libcmt.lib` / `libcmtd.lib`)

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### è¡¥ä¸ 4: OpenGL åº“ä¾èµ–é…ç½®ä¿®å¤

**æ–‡ä»¶**: `client/MT3Win32App/mt3.win32.vcxproj`

**é—®é¢˜**: è¯¯å°†ç§»åŠ¨å¹³å°ä¸“ç”¨ OpenGL ES åº“å¼•å…¥ Win32 é¡¹ç›®

**æ ¹æœ¬åŸå› **:
- Win32 å¹³å°ä½¿ç”¨åŸç”Ÿ OpenGL å®ç°ï¼Œé€šè¿‡ GLEW åº“è¿›è¡Œæ‰©å±•ç®¡ç†
- ç§»åŠ¨å¹³å°(åŒ…æ‹¬ WinRTã€WP8ã€Tizen)ä½¿ç”¨ OpenGL ES å®ç°ï¼Œä¾èµ– EGL è¿›è¡Œçª—å£ç³»ç»Ÿé›†æˆ
- å½“å‰é…ç½®é”™è¯¯åœ°åœ¨ Win32 å¹³å°å¼•å…¥äº†ç§»åŠ¨å¹³å°ä¸“ç”¨çš„ `libEGL.lib` å’Œ `libGLESv2.lib`

**æŠ€æœ¯åˆ†æ**:

**Win32 å¹³å° OpenGL å®ç°**:
- é‡‡ç”¨åŸç”Ÿ OpenGL API
- ä½¿ç”¨ `GL/glew.h` å¤´æ–‡ä»¶è¿›è¡Œ OpenGL æ‰©å±•ç®¡ç†
- é“¾æ¥ `opengl32.lib` å’Œ `glew32.lib` ç­‰ Win32 å¹³å°ä¸“ç”¨åº“

**ç§»åŠ¨å¹³å° OpenGL å®ç°**:
- ä½¿ç”¨ OpenGL ES (OpenGL for Embedded Systems) API
- ä¾èµ– EGL (Embedded-System Graphics Library) è¿›è¡Œçª—å£ç³»ç»Ÿé›†æˆ
- å¯¹åº”åº“æ–‡ä»¶ä¸º `libEGL.lib` å’Œ `libGLESv2.lib`

**ä¿®å¤å†…å®¹**:

ä» Win32 é¡¹ç›®é…ç½®ä¸­ç§»é™¤ä»¥ä¸‹ç§»åŠ¨å¹³å°ä¸“ç”¨åº“ä¾èµ–:

**Debug é…ç½®**:
```xml
<!-- ç§»é™¤ä»¥ä¸‹ä¾èµ– -->
libEGL.lib;
libGLESv2.lib;
```

**Release é…ç½®**:
```xml
<!-- ç§»é™¤ä»¥ä¸‹ä¾èµ– -->
libEGL.lib;
libGLESv2.lib;
```

**å…³é”®æ”¹åŠ¨**:
1. ç§»é™¤ Win32 å¹³å°ä¸­å¤šä½™çš„ç§»åŠ¨å¹³å° OpenGL ES åº“å¼•ç”¨
2. ç¡®ä¿ä»…é“¾æ¥ Win32 å¹³å°æ‰€éœ€çš„ OpenGL ç›¸å…³åº“

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ¯ ç¼–è¯‘é¡ºåºè¦æ±‚

ç”±äºä¾èµ–å…³ç³»,å¿…é¡»æŒ‰ä»¥ä¸‹é¡ºåºç¼–è¯‘:

1. **ç¬¬ä¸€é˜¶æ®µ**: åŸºç¡€åº“
   - liblua
   - libBox2D
   - libchipmunk
   - pcre
   - SILLY
   - libspeex, libogg, libvorbis

2. **ç¬¬äºŒé˜¶æ®µ**: ANGLE ç»„ä»¶
   - preprocessor
   - translator_common
   - translator_hlsl
   - esUtil

3. **ç¬¬ä¸‰é˜¶æ®µ**: Cocos2d-x æ ¸å¿ƒ
   - **libcocos2d** (ä¾èµ–ç¬¬ä¸€ã€äºŒé˜¶æ®µ)

4. **ç¬¬å››é˜¶æ®µ**: æ¸¸æˆæ¡†æ¶åº“
   - cegui
   - platform
   - cauthc
   - ljfm

5. **ç¬¬äº”é˜¶æ®µ**: æ¸¸æˆå¼•æ“
   - **engine** (ä¾èµ–å‰å››é˜¶æ®µ)

6. **ç¬¬å…­é˜¶æ®µ**: åº”ç”¨ç¨‹åº
   - FireClient
   - MT3

---

## ğŸ“ åº”ç”¨è¡¥ä¸æ–¹æ³•

### æ–¹æ³• 1: æ‰‹åŠ¨åº”ç”¨(å·²å®Œæˆ)

æ‰€æœ‰è¡¥ä¸å·²ç»åº”ç”¨åˆ°ä»£ç åº“ä¸­,æ— éœ€é¢å¤–æ“ä½œã€‚

### æ–¹æ³• 2: ä»å¤‡ä»½æ¢å¤åé‡æ–°åº”ç”¨

å¦‚æœéœ€è¦ä»å¤‡ä»½æ¢å¤å¹¶é‡æ–°åº”ç”¨è¡¥ä¸:

```powershell
# 1. SimpleAudioEngine å¤´æ–‡ä»¶ä¿®å¤
# ç¼–è¾‘ client/MT3Win32App/SimpleAudioEngineAdapter.cpp
# å°†ç¬¬ 4 è¡Œæ”¹ä¸º: #include "SimpleAudioEngine.h"

# 2. pthread.h timespec ä¿®å¤
# ç¼–è¾‘ cocos2d-2.0-rc2-x-2.0.1/cocos2dx/platform/third_party/win32/pthread/pthread.h
# æ›¿æ¢ç¬¬ 305-317 è¡Œä¸ºä¸Šè¿°ä¿®å¤åä»£ç 

# 3. CRT è¿è¡Œæ—¶åº“é…ç½®
# ç¼–è¾‘ client/MT3Win32App/mt3.win32.vcxproj
# ä¿®æ”¹ RuntimeLibrary å’Œé“¾æ¥å™¨è®¾ç½®

# 4. OpenGL åº“ä¾èµ–é…ç½®ä¿®å¤
# ç¼–è¾‘ client/MT3Win32App/mt3.win32.vcxproj
# åœ¨ Debug å’Œ Release é…ç½®ä¸­ç§»é™¤ä»¥ä¸‹ä¾èµ–é¡¹:
# libEGL.lib;
# libGLESv2.lib;
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç¼–è¯‘å™¨ç‰ˆæœ¬é™åˆ¶

è¿™äº›è¡¥ä¸ä¸“é—¨é’ˆå¯¹ **Visual Studio 2015** (ç‰ˆæœ¬ 14.0, `_MSC_VER = 1900`)ã€‚

å¦‚æœä½¿ç”¨å…¶ä»–ç‰ˆæœ¬:
- **VS2013 åŠæ›´æ—©**: ä¸éœ€è¦ timespec è¡¥ä¸
- **VS2017/2019/2022**: å¯èƒ½éœ€è¦é¢å¤–çš„å…¼å®¹æ€§ä¿®å¤

### 2. ç¬¬ä¸‰æ–¹åº“å…¼å®¹æ€§

æ‰€æœ‰ä¾èµ–åº“(libcocos2d, engine, platform ç­‰)å¿…é¡»ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ç¼–è¯‘å™¨é‡æ–°ç¼–è¯‘ã€‚

**ä¸èƒ½æ··ç”¨**:
- âŒ ä¸»ç¨‹åºç”¨ VS2015,åº“ç”¨ VS2010 ç¼–è¯‘
- âŒ éƒ¨åˆ†åº“ç”¨ VS2015,éƒ¨åˆ†åº“ç”¨ VS2013 ç¼–è¯‘
- âœ… æ‰€æœ‰ç»„ä»¶ç»Ÿä¸€ä½¿ç”¨ VS2015 ç¼–è¯‘

### 3. è¿è¡Œæ—¶åº“ä¾èµ–

ç¼–è¯‘åçš„ç¨‹åºéœ€è¦ä»¥ä¸‹è¿è¡Œæ—¶åº“:
- `MSVCP140.dll` (C++ æ ‡å‡†åº“)
- `VCRUNTIME140.dll` (C è¿è¡Œæ—¶åº“)
- `ucrtbase.dll` (Universal CRT)

ç”¨æˆ·éœ€è¦å®‰è£… **Visual C++ Redistributable for Visual Studio 2015**ã€‚

### 4. è°ƒè¯•ç‰ˆæœ¬æ³¨æ„äº‹é¡¹

Debug ç‰ˆæœ¬è¿˜éœ€è¦:
- `MSVCP140D.dll`
- `VCRUNTIME140D.dll`
- `ucrtbased.dll`

è¿™äº›æ–‡ä»¶ä¸èƒ½å•ç‹¬åˆ†å‘,ä»…ç”¨äºå¼€å‘ç¯å¢ƒã€‚

---

## ğŸ§ª éªŒè¯æ–¹æ³•

### éªŒè¯è¡¥ä¸æ˜¯å¦æ­£ç¡®åº”ç”¨

```powershell
# 1. æ£€æŸ¥ SimpleAudioEngineAdapter.cpp
$content = Get-Content "client\MT3Win32App\SimpleAudioEngineAdapter.cpp"
if ($content -match '#include "SimpleAudioEngine\.h"') {
    Write-Host "âœ“ è¡¥ä¸ 1 å·²åº”ç”¨" -ForegroundColor Green
} else {
    Write-Host "âœ— è¡¥ä¸ 1 æœªåº”ç”¨" -ForegroundColor Red
}

# 2. æ£€æŸ¥ pthread.h
$content = Get-Content "cocos2d-2.0-rc2-x-2.0.1\cocos2dx\platform\third_party\win32\pthread\pthread.h"
if ($content -match '_MSC_VER < 1900') {
    Write-Host "âœ“ è¡¥ä¸ 2 å·²åº”ç”¨" -ForegroundColor Green
} else {
    Write-Host "âœ— è¡¥ä¸ 2 æœªåº”ç”¨" -ForegroundColor Red
}

# 3. æ£€æŸ¥ mt3.win32.vcxproj
$content = Get-Content "client\MT3Win32App\mt3.win32.vcxproj"
if ($content -match 'legacy_stdio_definitions\.lib') {
    Write-Host "âœ“ è¡¥ä¸ 3 å·²åº”ç”¨" -ForegroundColor Green
} else {
    Write-Host "âœ— è¡¥ä¸ 3 æœªåº”ç”¨" -ForegroundColor Red
}

# 4. æ£€æŸ¥ OpenGL åº“ä¾èµ–é…ç½®
$content = Get-Content "client\MT3Win32App\mt3.win32.vcxproj"
if ($content -match 'libEGL\.lib|libGLESv2\.lib') {
    Write-Host "âœ— è¡¥ä¸ 4 æœªåº”ç”¨: ä»åŒ…å«ç§»åŠ¨å¹³å° OpenGL åº“" -ForegroundColor Red
} else {
    Write-Host "âœ“ è¡¥ä¸ 4 å·²åº”ç”¨" -ForegroundColor Green
}
```

### éªŒè¯ç¼–è¯‘æˆåŠŸ

```powershell
# æ£€æŸ¥å…³é”®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
$libs = @(
    "cocos2d-2.0-rc2-x-2.0.1\Release.win32\libcocos2d.lib",
    "engine\Release.win32\engine.lib",
    "client\FireClient\Release.win32\MT3.exe"
)

foreach ($lib in $libs) {
    if (Test-Path $lib) {
        $size = (Get-Item $lib).Length / 1MB
        Write-Host "âœ“ $lib ($([math]::Round($size, 2)) MB)" -ForegroundColor Green
    } else {
        Write-Host "âœ— ç¼ºå¤±: $lib" -ForegroundColor Red
    }
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [MT3é¡¹ç›®ç¼–è¯‘é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ.md](MT3é¡¹ç›®ç¼–è¯‘é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ.md) - å®Œæ•´çš„æŠ€æœ¯åˆ†æ
- [MT3ç¼–è¯‘å¿«é€ŸæŒ‡å—.md](MT3ç¼–è¯‘å¿«é€ŸæŒ‡å—.md) - å¿«é€Ÿå‚è€ƒæŒ‡å—

---

## ğŸ”— å‚è€ƒé“¾æ¥

### Visual Studio 2015 ç›¸å…³

- [Visual C++ Redistributable for Visual Studio 2015](https://www.microsoft.com/zh-cn/download/details.aspx?id=48145)
- [Universal CRT (UCRT) ä»‹ç»](https://docs.microsoft.com/zh-cn/cpp/porting/upgrade-your-code-to-the-universal-crt)
- [VS2015 æ–°ç‰¹æ€§](https://docs.microsoft.com/zh-cn/visualstudio/releasenotes/vs2015-version-history)

### Cocos2d-x ç›¸å…³

- [Cocos2d-x 2.0.1 å®˜æ–¹æ–‡æ¡£](https://docs.cocos2d-x.org/cocos2d-x/v2/en/)
- [pthread-win32 é¡¹ç›®](https://sourceware.org/pthreads-win32/)

### C/C++ æ ‡å‡†åº“

- [timespec ç»“æ„ä½“å®šä¹‰](https://en.cppreference.com/w/c/chrono/timespec)
- [MSVC é¢„å®šä¹‰å®](https://docs.microsoft.com/zh-cn/cpp/preprocessor/predefined-macros)

---

## ğŸ“Š è¡¥ä¸å†å²

| æ—¥æœŸ | è¡¥ä¸ç¼–å· | æè¿° | çŠ¶æ€ |
|------|----------|------|------|
| 2025-10-11 | Patch-001 | SimpleAudioEngine å¤´æ–‡ä»¶è·¯å¾„ä¿®å¤ | âœ… å·²åº”ç”¨ |
| 2025-10-11 | Patch-002 | pthread.h timespec é‡å®šä¹‰ä¿®å¤ | âœ… å·²åº”ç”¨ |
| 2025-10-11 | Patch-003 | CRT è¿è¡Œæ—¶åº“å†²çªä¿®å¤ | âœ… å·²åº”ç”¨ |
| 2025-10-11 | Patch-004 | OpenGL åº“ä¾èµ–é…ç½®ä¿®å¤ | âœ… å·²åº”ç”¨ |

---

## ğŸ’¡ æ•…éšœæ’é™¤

### é—®é¢˜ 1: ä»ç„¶å‡ºç° timespec é‡å®šä¹‰é”™è¯¯

**å¯èƒ½åŸå› **:
- è¡¥ä¸æœªæ­£ç¡®åº”ç”¨
- æ–‡ä»¶è¢«å…¶ä»–å·¥å…·è¦†ç›–

**è§£å†³æ–¹æ³•**:
```powershell
# é‡æ–°æ£€æŸ¥æ–‡ä»¶å†…å®¹
Get-Content "cocos2d-2.0-rc2-x-2.0.1\cocos2dx\platform\third_party\win32\pthread\pthread.h" | Select-Object -Skip 304 -First 20
```

ç¡®è®¤åŒ…å« `_MSC_VER < 1900` æ£€æŸ¥ã€‚

### é—®é¢˜ 2: LNK2005 é”™è¯¯ä»ç„¶å­˜åœ¨

**å¯èƒ½åŸå› **:
- ä¾èµ–åº“æœªé‡æ–°ç¼–è¯‘
- æ··ç”¨äº†ä¸åŒç‰ˆæœ¬çš„åº“

**è§£å†³æ–¹æ³•**:
```powershell
# æ¸…ç†æ‰€æœ‰æ—§çš„åº“æ–‡ä»¶
Remove-Item -Recurse -Force "cocos2d-2.0-rc2-x-2.0.1\Release.win32"
Remove-Item -Recurse -Force "engine\Release.win32"
# ... æ¸…ç†å…¶ä»–åº“ç›®å½•

# é‡æ–°ç¼–è¯‘æ‰€æœ‰åº“
.\build_all_dependencies.ps1
```

### é—®é¢˜ 3: è¿è¡Œæ—¶ç¼ºå°‘ DLL

**è§£å†³æ–¹æ³•**:
1. ä¸‹è½½å¹¶å®‰è£… VC++ 2015 Redistributable
2. æˆ–å°†ä»¥ä¸‹ DLL å¤åˆ¶åˆ°ç¨‹åºç›®å½•:
   - `MSVCP140.dll`
   - `VCRUNTIME140.dll`
   - `ucrtbase.dll`

è¿™äº›æ–‡ä»¶ä½äº:
```
C:\Windows\System32\  (64ä½ç³»ç»Ÿ)
C:\Windows\SysWOW64\ (32ä½ç¨‹åºåœ¨64ä½ç³»ç»Ÿä¸Š)
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-11  
**ç»´æŠ¤è€…**: MT3 é¡¹ç›®å›¢é˜Ÿ  
**é€‚ç”¨ç‰ˆæœ¬**: Visual Studio 2015 (14.0)
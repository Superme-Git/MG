# MT3 v140 (VS2015) ç¼–è¯‘é…ç½®è¯´æ˜

**åˆ›å»ºæ—¶é—´**: 2025-10-13
**å·¥å…·é›†**: v140 (Visual Studio 2015)
**é…ç½®**: Release
**å¹³å°**: Win32

---

## ğŸ“‹ æ ¸å¿ƒåŸåˆ™

### 1. **ç»Ÿä¸€å·¥å…·é›†** âœ…
æ‰€æœ‰é¡¹ç›®å¿…é¡»ä½¿ç”¨ **v140 (VS2015)** å·¥å…·é›†ç¼–è¯‘

```xml
<PlatformToolset>v140</PlatformToolset>
```

### 2. **ç»Ÿä¸€è¿è¡Œæ—¶åº“** âœ…
æ‰€æœ‰é¡¹ç›®å¿…é¡»ä½¿ç”¨ **/MD (MultiThreadedDLL)** è¿è¡Œæ—¶åº“

```xml
<RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>
```

### 3. **æ­£ç¡®çš„é“¾æ¥å™¨é…ç½®** âš ï¸ **å…³é”®!**

**åªå¿½ç•¥é™æ€è¿è¡Œæ—¶åº“,ä¸è¦å¿½ç•¥åŠ¨æ€è¿è¡Œæ—¶åº“:**

```xml
<!-- âœ… æ­£ç¡®é…ç½® -->
<IgnoreSpecificDefaultLibraries>libcmt.lib;libcmtd.lib</IgnoreSpecificDefaultLibraries>

<!-- âŒ é”™è¯¯é…ç½® - ä¸è¦è¿™æ ·åš! -->
<IgnoreSpecificDefaultLibraries>libcmt.lib;libcmtd.lib;msvcrt.lib;msvcrtd.lib</IgnoreSpecificDefaultLibraries>
```

**é‡è¦**: **ç»å¯¹ä¸èƒ½å¿½ç•¥ `msvcrt.lib`!** è¿™æ˜¯ /MD è¿è¡Œæ—¶çš„æ ¸å¿ƒåº“!

---

## ğŸ—ï¸ ç¼–è¯‘é¡ºåº (4å±‚æ¶æ„)

### ç¬¬ä¸€å±‚: åŸºç¡€åº“
æŒ‰ä»»æ„é¡ºåºç¼–è¯‘,æ— ç›¸äº’ä¾èµ–:

1. **platform.lib** - å¹³å°æŠ½è±¡å±‚
   - è·¯å¾„: `common\platform\platform.editor.vcxproj`
   - åŠŸèƒ½: è·¨å¹³å°æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€çº¿ç¨‹

2. **ljfm.lib** - æ–‡ä»¶ç®¡ç†åº“
   - è·¯å¾„: `common\ljfm\ljfm.vcxproj`
   - åŠŸèƒ½: æ–‡ä»¶ç®¡ç†å’Œæ›´æ–°å¼•æ“

3. **lua.lib** - Luaè„šæœ¬å¼•æ“
   - è·¯å¾„: `common\lua\lua.vcxproj`
   - åŠŸèƒ½: Lua 5.1 + tolua++ ç»‘å®š

4. **cauthc.lib** - è®¤è¯åº“
   - è·¯å¾„: `common\cauthc\projects\windows\cauthc.win32.vcxproj`
   - åŠŸèƒ½: å®¢æˆ·ç«¯è®¤è¯å’Œå®‰å…¨

### ç¬¬äºŒå±‚: Cocos2då¼•æ“
ä¾èµ–ç¬¬ä¸€å±‚çš„lua.lib:

5. **libcocos2d.dll** - Cocos2d-xæ ¸å¿ƒ
   - è·¯å¾„: `cocos2d-2.0-rc2-x-2.0.1\cocos2dx\proj.win32\cocos2d-win32.vcxproj`
   - åŠŸèƒ½: 2Dæ¸¸æˆå¼•æ“æ¡†æ¶

6. **libCocosDenshion.dll** - éŸ³é¢‘å¼•æ“
   - è·¯å¾„: `cocos2d-2.0-rc2-x-2.0.1\CocosDenshion\proj.win32\CocosDenshion.win32.vcxproj`
   - åŠŸèƒ½: éŸ³é¢‘æ’­æ”¾å’Œç®¡ç†

### ç¬¬ä¸‰å±‚: æ¸¸æˆå¼•æ“æ‰©å±•
ä¾èµ–å‰ä¸¤å±‚:

7. **engine.lib** - MT3æ¸¸æˆå¼•æ“
   - è·¯å¾„: `engine\engine.win32.vcxproj`
   - ä¾èµ–: platform, ljfm, cocos2d-x
   - åŠŸèƒ½: MT3ç‰¹å®šå¼•æ“åŠŸèƒ½

### ç¬¬å››å±‚: åº”ç”¨ç¨‹åº
ä¾èµ–æ‰€æœ‰å‰é¢çš„åº“:

8. **FireClient.lib** - æ¸¸æˆé€»è¾‘åº“
   - è·¯å¾„: `client\FireClient\FireClient.win32.vcxproj`
   - ä¾èµ–: æ‰€æœ‰åŸºç¡€åº“ + engine

9. **MT3.exe** - ä¸»ç¨‹åºå…¥å£
   - è·¯å¾„: `client\MT3Win32App\mt3.win32.vcxproj`
   - ä¾èµ–: æ‰€æœ‰åº“
   - åŠŸèƒ½: ç¨‹åºå…¥å£ç‚¹

---

## ğŸ“Š ä¾èµ–å…³ç³»å›¾

```
Layer 4: MT3.exe
           â†“
        FireClient.lib
           â†“
Layer 3: engine.lib
           â†“
Layer 2: libcocos2d.dll + libCocosDenshion.dll
           â†“
Layer 1: platform.lib, ljfm.lib, lua.lib, cauthc.lib
```

---

## ğŸ”§ MSBuild ç¼–è¯‘å‘½ä»¤æ¨¡æ¿

### åŸºæœ¬å‘½ä»¤æ ¼å¼
```batch
"C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Current\Bin\MSBuild.exe" ^
  é¡¹ç›®è·¯å¾„.vcxproj ^
  /t:Rebuild ^
  /p:Configuration=Release ^
  /p:Platform=Win32 ^
  /p:PlatformToolset=v140 ^
  /v:minimal ^
  /nologo ^
  /m
```

### å‚æ•°è¯´æ˜
- `/t:Rebuild` - å®Œå…¨é‡æ–°ç¼–è¯‘
- `/p:Configuration=Release` - Releaseé…ç½®
- `/p:Platform=Win32` - 32ä½å¹³å°
- `/p:PlatformToolset=v140` - å¼ºåˆ¶ä½¿ç”¨v140å·¥å…·é›†
- `/v:minimal` - æœ€å°è¾“å‡ºä¿¡æ¯
- `/nologo` - ä¸æ˜¾ç¤ºlogo
- `/m` - å¤šæ ¸å¹¶è¡Œç¼–è¯‘

---

## âš ï¸ å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: LNK2001 æœªè§£æçš„å¤–éƒ¨ç¬¦å·
**åŸå› **: è¿è¡Œæ—¶åº“ä¸åŒ¹é…æˆ–å¿½ç•¥äº†å¿…éœ€çš„æ ‡å‡†åº“

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ‰€æœ‰é¡¹ç›®çš„è¿è¡Œæ—¶åº“é…ç½®æ˜¯å¦ä¸º `/MD`
2. ç¡®ä¿ `IgnoreSpecificDefaultLibraries` **ä¸åŒ…å«** `msvcrt.lib`
3. é‡æ–°ç¼–è¯‘æ‰€æœ‰ä¾èµ–åº“

### é”™è¯¯2: æ‰¾ä¸åˆ° msvcr140.dll
**åŸå› **: ç¼ºå°‘ Visual C++ 2015 è¿è¡Œæ—¶

**è§£å†³æ–¹æ¡ˆ**:
å®‰è£… Visual C++ 2015 Redistributable:
```
https://www.microsoft.com/zh-cn/download/details.aspx?id=48145
```

### é”™è¯¯3: ç¼–è¯‘é¡ºåºé”™è¯¯
**åŸå› **: åœ¨ä¾èµ–åº“ç¼–è¯‘å®Œæˆå‰ç¼–è¯‘äº†ä¸Šå±‚é¡¹ç›®

**è§£å†³æ–¹æ¡ˆ**:
ä¸¥æ ¼æŒ‰ç…§4å±‚ç¼–è¯‘é¡ºåº,ä½¿ç”¨æä¾›çš„ `build_mt3_v140_final.bat` è„šæœ¬

### é”™è¯¯4: ç¬¦å·é‡å®šä¹‰
**åŸå› **: æ··ç”¨äº†é™æ€åº“å’ŒåŠ¨æ€åº“çš„è¿è¡Œæ—¶

**è§£å†³æ–¹æ¡ˆ**:
1. ç»Ÿä¸€ä½¿ç”¨ `/MD` (åŠ¨æ€è¿è¡Œæ—¶)
2. åœ¨é“¾æ¥å™¨ä¸­å¿½ç•¥ `libcmt.lib` å’Œ `libcmtd.lib`

---

## ğŸ“ éªŒè¯æ¸…å•

ç¼–è¯‘å®Œæˆå,æ£€æŸ¥ä»¥ä¸‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨:

### åŸºç¡€åº“ (Layer 1)
- [ ] `common\platform\Release.win32\platform.lib`
- [ ] `common\ljfm\Release.win32\ljfm.lib`
- [ ] `common\lua\Release.win32\lua.lib`
- [ ] `common\cauthc\projects\windows\Release.win32\cauthc.lib`

### å¼•æ“å±‚ (Layer 2)
- [ ] `cocos2d-2.0-rc2-x-2.0.1\Release.win32\libcocos2d.dll`
- [ ] `cocos2d-2.0-rc2-x-2.0.1\Release.win32\libCocosDenshion.dll`

### æ‰©å±•å±‚ (Layer 3)
- [ ] `engine\Release.win32\engine.lib`

### åº”ç”¨å±‚ (Layer 4)
- [ ] `client\FireClient\Release.win32\FireClient.lib`
- [ ] `client\MT3Win32App\Release.win32\MT3.exe`
- [ ] `client\resource\bin\Release\MT3.exe` (PostBuildå¤åˆ¶)

---

## ğŸš€ å¿«é€Ÿç¼–è¯‘æ­¥éª¤

### æ–¹æ³•1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ (æ¨è)
```batch
cd e:\æ¢¦å¹»è¥¿æ¸¸MGåŸç‰ˆæºç 
build_mt3_v140_final.bat
```

### æ–¹æ³•2: æ‰‹åŠ¨ç¼–è¯‘
```batch
cd e:\æ¢¦å¹»è¥¿æ¸¸MGåŸç‰ˆæºç 

:: Layer 1
msbuild common\platform\platform.editor.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
msbuild common\ljfm\ljfm.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
msbuild common\lua\lua.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
msbuild common\cauthc\projects\windows\cauthc.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m

:: Layer 2
msbuild cocos2d-2.0-rc2-x-2.0.1\cocos2dx\proj.win32\cocos2d-win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
msbuild cocos2d-2.0-rc2-x-2.0.1\CocosDenshion\proj.win32\CocosDenshion.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m

:: Layer 3
msbuild engine\engine.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m

:: Layer 4
msbuild client\FireClient\FireClient.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
msbuild client\MT3Win32App\mt3.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v140 /m
```

---

## ğŸ¯ ç¼–è¯‘åæµ‹è¯•

### æ­¥éª¤1: éªŒè¯æ–‡ä»¶
```batch
test_mt3_build.bat
```

### æ­¥éª¤2: è¿è¡Œç¨‹åº
```batch
cd client\resource\bin\Release
MT3.exe
```

### æ­¥éª¤3: æ£€æŸ¥ä¾èµ–é¡¹
```batch
dumpbin /DEPENDENTS client\MT3Win32App\Release.win32\MT3.exe
```

åº”è¯¥çœ‹åˆ°:
- `msvcr140.dll` æˆ– `VCRUNTIME140.dll` (v140è¿è¡Œæ—¶)
- `libcocos2d.dll`
- `libCocosDenshion.dll`
- Windowsç³»ç»ŸDLL (kernel32.dll, user32.dllç­‰)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç¼–è¯‘æˆåŠŸæŠ¥å‘Š.md](./ç¼–è¯‘æˆåŠŸæŠ¥å‘Š.md) - ç¬¬ä¸‰æ–¹åº“ç¼–è¯‘æŠ¥å‘Š
- [æœ€ç»ˆå¯ç”¨æ–¹æ¡ˆ.md](../æœ€ç»ˆå¯ç”¨æ–¹æ¡ˆ.md) - v120åŸå§‹ç‰ˆæœ¬è¯´æ˜
- [06-ç¼–è¯‘å®Œæ•´æŒ‡å—.md](../06-ç¼–è¯‘å®Œæ•´æŒ‡å—.md:1) - å¿«é€Ÿå…¥é—¨æŒ‡å—

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ç‰ˆæœ¬æ§åˆ¶**: åœ¨ç¼–è¯‘å‰æäº¤ä»£ç æ›´æ”¹
2. **æ¸…ç†ç¼–è¯‘**: ä½¿ç”¨ `/t:Rebuild` è€Œä¸æ˜¯ `/t:Build`
3. **å¹¶è¡Œç¼–è¯‘**: ä½¿ç”¨ `/m` å‚æ•°åˆ©ç”¨å¤šæ ¸CPU
4. **æœ€å°è¾“å‡º**: ä½¿ç”¨ `/v:minimal` å‡å°‘æ—¥å¿—å™ªéŸ³
5. **éªŒè¯ä¾èµ–**: ç¼–è¯‘åä½¿ç”¨ dumpbin æ£€æŸ¥ä¾èµ–é¡¹
6. **å¤‡ä»½æˆåŠŸç‰ˆæœ¬**: ä¿å­˜æˆåŠŸç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶

---

**æœ€åæ›´æ–°**: 2025-10-13
**ç»´æŠ¤è€…**: Claude Code Assistant
**çŠ¶æ€**: âœ… é…ç½®å·²éªŒè¯

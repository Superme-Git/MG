# Windows PC 快速开始指南

> **3步完成MT3 Windows客户端打包**
> **阅读时间**: 5分钟
> **实践时间**: 10-15分钟

---

## 🎯 核心流程

### 📌 前置条件

- ✅ Windows 7/8/10/11 系统
- ✅ Visual Studio 2012/2015/2019 (任一版本)
- ✅ 磁盘空间 > 5GB

---

## 🚀 三步打包流程

### Step 1: 环境验证 (1分钟)

```cmd
# 验证MSBuild可用
MSBuild /version

# 验证工具集安装
dir "C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\VC\Tools\MSVC"
```

**期望输出**:
- MSBuild版本号 (如: 15.0 / 16.0 / 17.0)
- 工具集目录存在

**如果失败**: → 查阅 [03_环境配置指南.md](03_环境配置指南.md)

---

### Step 2: 执行编译 (5-10分钟)

#### 方式A: 使用一键脚本(推荐)

```cmd
cd e:\MT3\client\MT3Win32App
build_release.bat
```

#### 方式B: 手动MSBuild命令

```cmd
cd e:\MT3

# Debug版本
"C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Current\Bin\MSBuild.exe" ^
  client\MT3Win32App\mt3.win32.vcxproj ^
  /t:Rebuild ^
  /p:Configuration=Debug ^
  /p:Platform=Win32 ^
  /p:PlatformToolset=v140 ^
  /v:minimal ^
  /nologo ^
  /m

# Release版本
"C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Current\Bin\MSBuild.exe" ^
  client\MT3Win32App\mt3.win32.vcxproj ^
  /t:Rebuild ^
  /p:Configuration=Release ^
  /p:Platform=Win32 ^
  /p:PlatformToolset=v120 ^
  /v:minimal ^
  /nologo ^
  /m
```

**编译进度**:
```
正在编译 platform.lib ... (1/3)
正在编译 cocos2d.lib ... (2/3)
正在链接 MT3.exe ... (3/3)
编译成功! ✓
```

**输出位置**:
- Debug: `client\MT3Win32App\Debug.win32\MT3.exe`
- Release: `client\MT3Win32App\Release.win32\MT3.exe`

---

### Step 3: 验证与测试 (2分钟)

```cmd
# 1. 验证EXE生成
dir client\MT3Win32App\Release.win32\MT3.exe

# 2. 检查依赖库
dumpbin /dependents client\MT3Win32App\Release.win32\MT3.exe

# 3. 运行测试
cd client\MT3Win32App\Release.win32
MT3.exe
```

**验证要点**:
- [x] MT3.exe 文件存在
- [x] 文件大小 > 10MB
- [x] 依赖库完整(msvcr120.dll / msvcr140.dll等)
- [x] 启动无崩溃
- [x] 可正常进入游戏界面

---

## ⚡ 常见问题 Top 5

### 问题1: MSBuild命令找不到

**现象**:
```
'MSBuild' 不是内部或外部命令
```

**解决**:
```cmd
# 添加到PATH或使用完整路径
"C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Current\Bin\MSBuild.exe"
```

**详细**: → [05_问题诊断决策树.md#环境配置](05_问题诊断决策树.md)

---

### 问题2: 平台工具集不存在

**现象**:
```
error MSB8020: 无法找到平台工具集"v120"
```

**解决**:
```cmd
# 切换到已安装的工具集
/p:PlatformToolset=v140  # 或 v142
```

**详细**: → [附录B_跨平台工具集适配指南.md](附录B_跨平台工具集适配指南.md)

---

### 问题3: 链接错误 - 找不到库

**现象**:
```
LINK : fatal error LNK1104: 无法打开文件"platform.lib"
```

**解决**:
```cmd
# 先编译依赖库
MSBuild common\platform\platform.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32
MSBuild cocos2d-2.0-rc2-x-2.0.1\cocos2dx\proj.win32\cocos2d.win32.vcxproj /t:Rebuild /p:Configuration=Release /p:Platform=Win32

# 再编译主程序
MSBuild client\MT3Win32App\mt3.win32.vcxproj ...
```

**详细**: → [04_构建流程详解.md#依赖关系](04_构建流程详解.md)

---

### 问题4: 运行时缺少DLL

**现象**:
```
启动时提示: 无法启动此程序,因为计算机中丢失 msvcr120.dll
```

**解决**:
```cmd
# 安装对应的Visual C++ Redistributable
# v120 → VC++ 2013 Redistributable
# v140 → VC++ 2015-2019 Redistributable

# 或复制DLL到exe目录
copy "C:\Windows\System32\msvcr120.dll" client\MT3Win32App\Release.win32\
```

**详细**: → [05_问题诊断决策树.md#运行时错误](05_问题诊断决策树.md)

---

### 问题5: 启动崩溃无错误提示

**现象**:
- EXE启动后立即退出
- 无任何错误弹窗

**解决**:
```cmd
# 1. 使用Debug版本查看日志
cd client\MT3Win32App\Debug.win32
MT3.exe

# 2. 查看Windows事件查看器
eventvwr.msc
→ Windows日志 → 应用程序

# 3. 使用调试器
devenv /debugexe client\MT3Win32App\Release.win32\MT3.exe
```

**详细**: → [06_完整排错手册.md#崩溃分析](06_完整排错手册.md)

---

## 📊 典型打包时间

| 编译配置 | 全量编译 | 增量编译 | 验证测试 |
|---------|---------|---------|---------|
| **Debug** | 8-12分钟 | 2-3分钟 | 1分钟 |
| **Release** | 10-15分钟 | 3-5分钟 | 1分钟 |

**影响因素**:
- CPU核心数 (/m参数使用多核编译)
- 磁盘类型 (SSD > HDD)
- 杀毒软件 (实时扫描影响性能)

---

## 🔍 打包前检查清单(简化版)

快速检查(1分钟):

```cmd
# 1. 环境工具
MSBuild /version  ✓

# 2. 依赖库存在
dir common\platform\Release.win32\platform.lib  ✓
dir cocos2d-2.0-rc2-x-2.0.1\Debug.win32\cocos2d.lib  ✓

# 3. 磁盘空间
dir e:\  (确保>3GB可用)  ✓
```

**完整检查**: → [02_打包前检查清单.md](02_打包前检查清单.md)

---

## 🎓 下一步学习

### 日常使用
- **每次打包前**: 查阅 [02_打包前检查清单.md](02_打包前检查清单.md)
- **遇到问题**: 查阅 [05_问题诊断决策树.md](05_问题诊断决策树.md)

### 深入理解
- **编译原理**: 查阅 [04_构建流程详解.md](04_构建流程详解.md)
- **高级配置**: 查阅 [附录B_跨平台工具集适配指南.md](附录B_跨平台工具集适配指南.md)

---

## 💡 小技巧

### 加速编译

```cmd
# 使用多核编译
MSBuild ... /m:8  # 使用8个并行进程

# 仅编译修改的项目
MSBuild ... /t:Build  # 而非 /t:Rebuild
```

### 日志记录

```cmd
# 保存详细日志
MSBuild ... /v:detailed /fl /flp:LogFile=build.log
```

### 清理构建

```cmd
# 清理中间文件
MSBuild ... /t:Clean

# 或手动删除
rd /s /q client\MT3Win32App\Release.win32
rd /s /q client\MT3Win32App\Debug.win32
```

---

## 📞 获取支持

- **文档索引**: [00_README.md](00_README.md)
- **问题诊断**: [05_问题诊断决策树.md](05_问题诊断决策树.md)
- **完整手册**: [06_完整排错手册.md](06_完整排错手册.md)

---

**恭喜!** 您已掌握Windows客户端打包基础流程 🎉

如需深入学习,请继续阅读其他文档。
